"use strict";var e=require("solid"),t=require("utils");const s="web",o="phone",r="desktop",p="not_supported",a=(e,t)=>{const p=new URLSearchParams(window.location.hash.slice(1)).get("tgWebAppVersion");return Number(p)>=e&&-1!==t.indexOf((()=>{const e=window.location.hash.slice(1),t=new URLSearchParams(e).get("tgWebAppPlatform")??"ios";return["android","ios"].includes(t)?o:["tdesktop","macos"].includes(t)?r:s})())},n=()=>Math.random().toString(36).substring(3,9),u=()=>a(0,[s,r,o]),i=()=>d()?(D(J),{status:!0}):(Q(J,1),{status:p}),d=()=>a(6.4,[o]),_=()=>a(0,[s,r,o]),c=()=>a(0,[o]),x=()=>a(0,[s]),l=()=>a(0,[s]),h="web_app_invoke_custom_method",g=()=>a(6.9,[s,r,o]),b=()=>a(6.1,[s,r,o]),w=()=>a(6.4,[s,r,o]),m=()=>a(6.2,[s,r,o]),v=()=>a(6.4,[o]),S=()=>a(7,[s,r,o]),f=()=>a(6.4,[s,r,o]),P=()=>a(6.9,[s,r,o]),q=()=>a(6.9,[s,r,o]),M=()=>a(0,[s,r,o]),R=()=>a(0,[s,r,o]),k=()=>a(6.9,[s,r,o]),y=()=>a(6.1,[s,r,o]),C=()=>a(6.1,[s,r,o]),E=()=>a(6.1,[s,r,o]),T=()=>a(0,[s,r,o]),O=()=>a(0,[s,r,o]),B=()=>a(6.1,[s,r,o]),I=()=>a(6.7,[s,r,o]),W=()=>a(6.1,[o]);var Q=(e,t)=>{"development"===process.env.NODE_ENV&&console.error(`[@apiteam/twa-bridge](${e}) = ${t}`)};var D=(e,t)=>{window.TelegramWebviewProxy?window.TelegramWebviewProxy.postEvent(e,JSON.stringify(t)):window.external&&"notify"in window.external&&window.external.notify(JSON.stringify({eventType:e,eventData:t}))};const L=((e=new Map)=>({once:(t,s,o=e.get(t),r=(e=>{s(e),o&&o.splice(o.indexOf(s)>>>0,1)}))=>o?o.push(r):e.set(t,[r]),on:(t,s,o=e.get(t))=>o?o.push(s):e.set(t,[s]),off:(t,s,o=e.get(t))=>o&&s?o.splice(o.indexOf(s)>>>0,1):e.set(t,[]),emit:(t,s,o=e.get(t)||[])=>{for(const e of o)e(s)}}))();(()=>{function s(s,o){s===e.EventThemeChanged&&(o.theme_params=t.getThemeParams(o.theme_params)),L.emit(s,o),L.emit("*",{name:s,data:o})}window.TelegramGameProxy_receiveEvent=s,window.Telegram={WebView:{receiveEvent:s}},window.TelegramGameProxy={receiveEvent:s}})();const N=(e,t)=>{L.on(e,t)},A=(e,t)=>{L.off(e,t)},H=(e,t)=>{L.once(e,t)};var V=Object.freeze({__proto__:null,off:A,on:N,once:H});const F="web_app_open_scan_qr_popup",G="web_app_read_text_from_clipboard",U="web_app_request_phone",$="web_app_close",J="web_app_close_scan_qr_popup",j="web_app_data_send",z="web_app_expand",K="iframe_ready",X="web_app_open_invoice",Y="web_app_open_link",Z="web_app_open_popup",ee="web_app_open_tg_link",te="web_app_ready",se="web_app_request_theme",oe="web_app_request_viewport",re="web_app_request_write_access",pe="web_app_set_background_color",ae="web_app_set_header_color",ne="web_app_setup_back_button",ue="web_app_setup_closing_behavior",ie="web_app_setup_main_button",de="web_app_setup_settings_button",_e="web_app_switch_inline_query",ce="web_app_trigger_haptic_feedback",xe="clipboard_text_received",le="custom_method_invoked",he="phone_requested",ge="popup_closed",be="qr_text_received",we="scan_qr_popup_closed";exports.EventBackButtonPressed="back_button_pressed",exports.EventClipboardTextReceived=xe,exports.EventCustomMethodInvoked=le,exports.EventInvoiceClosed="invoice_closed",exports.EventMainButtonPressed="main_button_pressed",exports.EventPhoneRequested=he,exports.EventPopupClosed=ge,exports.EventQrTextReceived=be,exports.EventReloadIframe="reload_iframe",exports.EventScanQrPopupClosed=we,exports.EventSetCustomStyle="set_custom_style",exports.EventSettingsButtonPressed="settings_button_pressed",exports.EventThemeChanged="theme_changed",exports.EventViewportChanged="viewport_changed",exports.EventWriteAccessRequested="write_access_requested",exports.MethodClose=$,exports.MethodCloseScanQrPopup=J,exports.MethodDataSend=j,exports.MethodExpand=z,exports.MethodIframeReady=K,exports.MethodIframeWillReload="iframe_will_reload",exports.MethodInvokeCustomMethod="web_app_invoke_custom_method",exports.MethodOpenInvoice=X,exports.MethodOpenLink=Y,exports.MethodOpenPopup=Z,exports.MethodOpenScanQrPopup=F,exports.MethodOpenTgLink=ee,exports.MethodReadTextFromClipboard=G,exports.MethodReady=te,exports.MethodRequestPhone=U,exports.MethodRequestTheme=se,exports.MethodRequestViewport=oe,exports.MethodRequestWriteAccess=re,exports.MethodSetBackgroundColor=pe,exports.MethodSetHeaderColor=ae,exports.MethodSetupBackButton=ne,exports.MethodSetupClosingBehavior=ue,exports.MethodSetupMainButton=ie,exports.MethodSetupSettingsButton=de,exports.MethodSwitchInlineQuery=_e,exports.MethodTriggerHapticFeedback=ce,exports.NOT_SUPPORTED=p,exports.TG_DESKTOP=r,exports.TG_PHONE=o,exports.TG_WEB=s,exports.bridgeClose=()=>u()?(D($),{status:!0}):(Q($,1),{status:p}),exports.bridgeCloseScanQrPopup=i,exports.bridgeDataSend=e=>_()?(D(j,e),{status:!0}):(Q(j,1),{status:p}),exports.bridgeExpand=()=>c()?(D(z),{status:!0}):(Q(z,1),{status:p}),exports.bridgeGetInitData=()=>{const e=new URLSearchParams(window.location.hash.slice(1)).get("tgWebAppData");if(null===e)return Q("getInitData",2),null;const t=new URLSearchParams(e);let s={};return t.forEach(((e,t)=>{if(s[t]=e,void 0!==t.match(/^(chat|receiver|user)$/g))try{s[t]=JSON.parse(e)}catch{}})),s},exports.bridgeIframeReady=e=>x()?(D(K,e),{status:!0}):(Q(K,1),{status:p}),exports.bridgeIframeWillReload=()=>l()?(D(K),{status:!0}):(Q(K,1),{status:p}),exports.bridgeInvokeCustomMethod=async e=>g()?(void 0===e.req_id&&(e.req_id=n()),D(h,e),new Promise(((t,s)=>{const o=s=>{s.req_id===e.req_id&&(t({status:!0,data:s}),A(le,o))};N(le,o)}))):(Q(h,1),{status:p}),exports.bridgeOpenInvoice=e=>b()?(D(X,e),{status:!0}):(Q(X,1),{status:p}),exports.bridgeOpenLink=e=>w()?(D(Y,e),{status:!0}):(Q(Y,1),{status:p}),exports.bridgeOpenPopup=async e=>m()?(e.title.length>64&&Q(Z,3),e.message.length<1&&Q(Z,4),e.message.length>256&&Q(Z,5),e.buttons.length<1&&Q(Z,6),e.buttons.length>3&&Q(Z,7),void 0!==e.buttons.find((e=>e.text?.match(/^(ok|close|cancel)$/g)))&&Q(Z,8),D(Z,e),new Promise(((t,s)=>{const o=s=>{t({status:!!e.buttons.find((e=>e.id===s?.button_id)),data:s}),A(ge,o)};N(ge,o)}))):(Q(Z,1),{status:p}),exports.bridgeOpenScanQrPopup=async e=>v()?(D(F,e),new Promise(((t,s)=>{H(be,(s=>{e.is_close&&i(),t({status:!0,data:s})})),H(we,(()=>{t({status:"closed"})}))}))):(Q(F,1),{status:p}),exports.bridgeOpenTgLink=e=>("/"!==e.path_full[0]&&(e.path_full="/"+e.path_full),S()?(D(ee,e),{status:!0}):(Q(ee,1),{status:p})),exports.bridgeReadTextFromClipboard=async e=>f()?(void 0===e.req_id&&(e.req_id=n()),D(G,e),new Promise(((t,s)=>{const o=s=>{s.req_id===e.req_id&&(t({status:!0,data:s}),A(xe,o))};N(xe,o)}))):(Q(G,1),{status:p}),exports.bridgeReady=()=>P()?(D(te),{status:!0}):(Q(te,1),{status:p}),exports.bridgeRequestPhone=async()=>q()?(D(U),new Promise(((e,t)=>{H(he,(t=>{"sent"===t.status&&e({status:!0}),e({status:!1})}))}))):(Q(U,1),{status:p}),exports.bridgeRequestTheme=()=>M()?(D(se),{status:!0}):(Q(se,1),{status:p}),exports.bridgeRequestViewport=()=>R()?(D(oe),{status:!0}):(Q(oe,1),{status:p}),exports.bridgeRequestWriteAccess=()=>k()?(D(re),{status:!0}):(Q(re,1),{status:p}),exports.bridgeSetBackgroundColor=e=>y()?(D(pe,e),{status:!0}):(Q(pe,1),{status:p}),exports.bridgeSetHeaderColor=e=>C()?(D(ae,e),{status:!0}):(Q(ae,1),{status:p}),exports.bridgeSetupBackButton=e=>E()?(D(ne,e),{status:!0}):(Q(ne,1),{status:p}),exports.bridgeSetupClosingBehavior=e=>T()?(D(ue,e),{status:!0}):(Q(ue,1),{status:p}),exports.bridgeSetupMainButton=e=>O()?(D(ie,e),{status:!0}):(Q(ie,1),{status:p}),exports.bridgeSetupSettingsButton=e=>B()?(D(de,e),{status:!0}):(Q(de,1),{status:p}),exports.bridgeSwitchInlineQuery=e=>I()?(e.query.length>256&&Q(_e,9),D(_e,e),{status:!0}):(Q(_e,1),{status:p}),exports.bridgeTriggerHapticFeedback=e=>W()?(D(ce,e),{status:!0}):(Q(ce,1),{status:p}),exports.debug=Q,exports.listener=V,exports.sender=D,exports.supportClose=u,exports.supportCloseScanQrPopup=d,exports.supportDataSend=_,exports.supportExpand=c,exports.supportIframeReady=x,exports.supportIframeWillReload=l,exports.supportInvokeCustomMethod=g,exports.supportOpenInvoice=b,exports.supportOpenLink=w,exports.supportOpenPopup=m,exports.supportOpenScanQrPopup=v,exports.supportOpenTgLink=S,exports.supportReadTextFromClipboard=f,exports.supportReady=P,exports.supportRequestPhone=q,exports.supportRequestTheme=M,exports.supportRequestViewport=R,exports.supportRequestWriteAccess=k,exports.supportSetBackgroundColor=y,exports.supportSetHeaderColor=C,exports.supportSetupBackButton=E,exports.supportSetupClosingBehavior=T,exports.supportSetupMainButton=O,exports.supportSetupSettingsButton=B,exports.supportSwitchInlineQuery=I,exports.supportTriggerHapticFeedback=W;
