import{createSignal as e,onMount as t,onCleanup as s,createContext as a,createEffect as o}from"solid-js";import{createStore as r}from"solid-js/store";const n=()=>{const[a,o]=e({height:0,is_expanded:!1,is_state_stable:!1}),r=e=>o(e);return t((()=>{wt(gt,r),qe(He)})),s((()=>{mt(gt,r)})),a},i="web",p="phone",u="desktop",_=()=>{const e=window.location.hash.slice(1),t=new URLSearchParams(e).get("tgWebAppPlatform")??"ios";return["android","ios"].includes(t)?p:["tdesktop","macos"].includes(t)?u:i},d="not_supported",c=(e,t)=>{const s=new URLSearchParams(window.location.hash.slice(1)).get("tgWebAppVersion");return Number(s?.replace(".",""))>=Number(String(e)?.replace(".",""))&&-1!==t.indexOf(_())},g=()=>Math.random().toString(36).substring(3,9),l=e=>{var t;if(t=/^\s*#([0-9a-f]{6})\s*$/i.exec(e+=""))return"#"+t[1].toLowerCase();if(t=/^\s*#([0-9a-f])([0-9a-f])([0-9a-f])\s*$/i.exec(e))return("#"+t[1]+t[1]+t[2]+t[2]+t[3]+t[3]).toLowerCase();if(t=/^\s*rgba?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*(\d+\.{0,1}\d*))?\)\s*$/.exec(e)){var s=parseInt(t[1]),a=parseInt(t[2]),o=parseInt(t[3]);return"#"+((s<16?"0":"")+s.toString(16))+((a<16?"0":"")+a.toString(16))+((o<16?"0":"")+o.toString(16))}return!1},b=e=>{const t=window.location.hash.slice(1),s=new URLSearchParams(t),a=JSON.parse(s.get("tgWebAppThemeParams")??""),o=e||a;for(var r of Object.keys(o)){var n=l(o[r]);"string"==typeof n&&(o[r]=n)}return"#1c1c1d"==o?.bg_color&&o?.bg_color==o?.secondary_bg_color&&(o.secondary_bg_color="#2c2c2e"),o.bottom_bar_bg_color,o},w=e=>m()?(qe(Be,e),{status:!0}):(ye(Be,1),{status:d}),m=()=>c(0,[i,u,p]),h=e=>S()?(qe(Ce,e),{status:!0}):(ye(Ce,1),{status:d}),S=()=>c(6.4,[p]),v=e=>f()?(qe(Ie,e),{status:!0}):(ye(Ie,1),{status:d}),f=()=>c(0,[i,u,p]),y=e=>k()?(qe(Te,e),{status:!0}):(ye(Te,1),{status:d}),k=()=>c(0,[p]),q=e=>P()?(qe(Le,e),{status:!0}):(ye(Le,1),{status:d}),P=()=>c(0,[i]),R=()=>O()?(qe(Le),{status:!0}):(ye(Le,1),{status:d}),O=()=>c(0,[i]),x=async e=>B()?(void 0===e.req_id&&(e.req_id=g()),qe(Pe,e),new Promise(((t,s)=>{const a=s=>{s.req_id===e.req_id&&(t({status:!0,data:s}),mt(st,a))};wt(st,a)}))):(ye(Pe,1),{status:d}),B=()=>c(6.9,[i,u,p]),C=e=>I()?(qe(Ne,e),{status:!0}):(ye(Ne,1),{status:d}),I=()=>c(6.1,[i,u,p]),T=e=>L()?(qe(De,e),{status:!0}):(ye(De,1),{status:d}),L=()=>c(6.4,[i,u,p]),W=async e=>N()?(e.title.length>64&&ye(Ee,3),e.message.length<1&&ye(Ee,4),e.message.length>256&&ye(Ee,5),e.buttons.length<1&&ye(Ee,6),e.buttons.length>3&&ye(Ee,7),void 0!==e.buttons.find((e=>e.text?.match(/^(ok|close|cancel)$/g)))&&ye(Ee,8),qe(Ee,e),new Promise(((t,s)=>{const a=s=>{t({status:!!e.buttons.find((e=>e.id===s?.button_id)),data:s}),mt(nt,a)};wt(nt,a)}))):(ye(Ee,1),{status:d}),N=()=>c(6.2,[i,u,p]),D=async e=>E()?(qe(Re,e),new Promise(((t,s)=>{ht(pt,(s=>{e.is_close&&h(),t({status:!0,data:s})})),ht(ut,(()=>{t({status:"closed"})}))}))):(ye(Re,1),{status:d}),E=()=>c(6.4,[p]),M=e=>("/"!==e.path_full[0]&&(e.path_full="/"+e.path_full),Q()?(qe(Me,e),{status:!0}):(ye(Me,1),{status:d})),Q=()=>c(7,[i,u,p]),A=async e=>H()?(e||(e={req_id:void 0}),void 0===e.req_id&&(e.req_id=g()),qe(Oe,e),new Promise(((t,s)=>{const a=s=>{s.req_id===e?.req_id&&(t({status:!0,data:s}),mt(tt,a))};wt(tt,a)}))):(ye(Oe,1),{status:d}),H=()=>c(6.4,[i,u,p]),J=e=>$()?(qe(Qe,e),{status:!0}):(ye(Qe,1),{status:d}),$=()=>c(6.9,[i,u,p]),j=async()=>F()?(qe(xe),new Promise(((e,t)=>{ht(rt,(t=>{"sent"===t.status&&e({status:!0}),e({status:!1})}))}))):(ye(xe,1),{status:d}),F=()=>c(6.9,[i,u,p]),U=e=>V()?(qe(Ae,e),{status:!0}):(ye(Ae,1),{status:d}),V=()=>c(0,[i,u,p]),G=e=>z()?(qe(He,e),{status:!0}):(ye(He,1),{status:d}),z=()=>c(0,[i,u,p]),K=()=>X()?(qe(Je),{status:!0}):(ye(Je,1),{status:d}),X=()=>c(6.9,[i,u,p]),Y=e=>Z()?(qe($e,e),{status:!0}):(ye($e,1),{status:d}),Z=()=>c(6.1,[i,u,p]),ee=e=>te()?(qe(je,e),{status:!0}):(ye(je,1),{status:d}),te=()=>c(6.1,[i,u,p]),se=e=>ae()?(qe(Fe,{color:e?.color||e?.color_key}),{status:!0}):(ye(Fe,1),{status:d}),ae=()=>c(710,[i,u,p]),oe=e=>re()?(qe(Ue,e),{status:!0}):(ye(Ue,1),{status:d}),re=()=>c(6.1,[i,u,p]),ne=e=>ie()?(qe(Ve,e),{status:!0}):(ye(Ve,1),{status:d}),ie=()=>c(0,[i,u,p]),pe=e=>ue()?(qe(Ge,e),{status:!0}):(ye(Ge,1),{status:d}),ue=()=>c(0,[i,u,p]),_e=e=>de()?(qe(ze,e),{status:!0}):(ye(ze,1),{status:d}),de=()=>c(6.1,[i,u,p]),ce=e=>ge()?(e.query.length>256&&ye(Ke,9),qe(Ke,e),{status:!0}):(ye(Ke,1),{status:d}),ge=()=>c(6.7,[i,u,p]),le=e=>be()?(qe(Xe,e),{status:!0}):(ye(Xe,1),{status:d}),be=()=>c(6.1,[p]),we=({key:e,value:t})=>{try{return window.sessionStorage.setItem("__telegram__"+e,JSON.stringify(t)),{status:!0}}catch(s){return window.sessionStorage.setItem("__telegram__"+e,t),{status:!0}}},me=()=>!0,he=({key:e})=>{try{return{is_json:!0,value:JSON.parse(window.sessionStorage.getItem("__telegram__"+e)??""),status:!0}}catch(t){return{is_json:!1,value:window.sessionStorage.getItem("__telegram__"+e)??"",status:!0}}},Se=()=>!0,ve=e=>fe()?(qe(Ye,e),{status:!0}):(ye(Ye,1),{status:d}),fe=()=>c(7.7,[i,u,p]);var ye=(e,t)=>{"development"===process.env.NODE_ENV&&console.error(`[@apiteam/twa-bridge](${e}) = ${t}`)};const ke=()=>{const e=window.location.hash.slice(1),t=new URLSearchParams(e).get("tgWebAppData");if(!t)return void ye("getInitData",2);const s=new URLSearchParams(t);let a={};return s.forEach(((e,t)=>{if(a[t]=e,void 0!==t.match(/^(chat|receiver|user)$/g))try{a[t]=JSON.parse(e)}catch{}})),a};var qe=(e,t)=>{if(window.TelegramWebviewProxy)window.TelegramWebviewProxy.postEvent(e,JSON.stringify(t));else if(window.external&&"notify"in window.external)window.external.notify(JSON.stringify({eventType:e,eventData:t}));else try{"*",window.parent.postMessage(JSON.stringify({eventType:e,eventData:t}),"*")}catch(e){ye("postMessage Iframe",10)}};const Pe="web_app_invoke_custom_method",Re="web_app_open_scan_qr_popup",Oe="web_app_read_text_from_clipboard",xe="web_app_request_phone",Be="web_app_close",Ce="web_app_close_scan_qr_popup",Ie="web_app_data_send",Te="web_app_expand",Le="iframe_ready",We="iframe_will_reload",Ne="web_app_open_invoice",De="web_app_open_link",Ee="web_app_open_popup",Me="web_app_open_tg_link",Qe="web_app_ready",Ae="web_app_request_theme",He="web_app_request_viewport",Je="web_app_request_write_access",$e="web_app_set_background_color",je="web_app_set_header_color",Fe="web_app_set_bottom_bar_color",Ue="web_app_setup_back_button",Ve="web_app_setup_closing_behavior",Ge="web_app_setup_main_button",ze="web_app_setup_settings_button",Ke="web_app_switch_inline_query",Xe="web_app_trigger_haptic_feedback",Ye="web_app_setup_swipe_behavior";var Ze=(e=>(e[e.InvokeCustomMethod=Pe]="InvokeCustomMethod",e[e.OpenScanQrPopup=Re]="OpenScanQrPopup",e[e.ReadTextFromClipboard=Oe]="ReadTextFromClipboard",e[e.RequestPhone=xe]="RequestPhone",e[e.Close=Be]="Close",e[e.CloseScanQrPopup=Ce]="CloseScanQrPopup",e[e.DataSend=Ie]="DataSend",e[e.Expand=Te]="Expand",e[e.IframeReady=Le]="IframeReady",e[e.IframeWillReload=We]="IframeWillReload",e[e.OpenInvoice=Ne]="OpenInvoice",e[e.OpenLink=De]="OpenLink",e[e.OpenPopup=Ee]="OpenPopup",e[e.OpenTgLink=Me]="OpenTgLink",e[e.Ready=Qe]="Ready",e[e.RequestTheme=Ae]="RequestTheme",e[e.RequestViewport=He]="RequestViewport",e[e.RequestWriteAccess=Je]="RequestWriteAccess",e[e.SetBackgroundColor=$e]="SetBackgroundColor",e[e.SetHeaderColor=je]="SetHeaderColor",e[e.SetBottomBarColor=Fe]="SetBottomBarColor",e[e.SetupBackButton=Ue]="SetupBackButton",e[e.SetupClosingBehavior=Ve]="SetupClosingBehavior",e[e.SetupMainButton=Ge]="SetupMainButton",e[e.SetupSettingsButton=ze]="SetupSettingsButton",e[e.SwitchInlineQuery=Ke]="SwitchInlineQuery",e[e.TriggerHapticFeedback=Xe]="TriggerHapticFeedback",e[e.SetupSwipeBehavior=Ye]="SetupSwipeBehavior",e))(Ze||{});const et="back_button_pressed",tt="clipboard_text_received",st="custom_method_invoked",at="invoice_closed",ot="main_button_pressed",rt="phone_requested",nt="popup_closed",it="reload_iframe",pt="qr_text_received",ut="scan_qr_popup_closed",_t="set_custom_style",dt="settings_button_pressed",ct="theme_changed",gt="viewport_changed",lt="write_access_requested",bt=((e=new Map)=>({once:(t,s,a=e.get(t),o=(e=>{s(e),a&&a.splice(a.indexOf(s)>>>0,1)}))=>a?a.push(o):e.set(t,[o]),on:(t,s,a=e.get(t))=>a?a.push(s):e.set(t,[s]),off:(t,s,a=e.get(t))=>a&&s?a.splice(a.indexOf(s)>>>0,1):e.set(t,[]),emit:(t,s,a=e.get(t)||[])=>{for(const e of a)e(s)}}))();(()=>{function e(e,t){e===ct&&(t.theme_params=b(t.theme_params)),bt.emit(e,t),bt.emit("*",{name:e,data:t})}window.TelegramGameProxy_receiveEvent=e,window.Telegram={WebView:{receiveEvent:e}},window.TelegramGameProxy={receiveEvent:e}})();const wt=(e,t)=>{bt.on(e,t)},mt=(e,t)=>{bt.off(e,t)},ht=(e,t)=>{bt.once(e,t)};var St=Object.freeze({__proto__:null,off:mt,on:wt,once:ht});const vt=()=>{const e=window.location.hash.slice(1);return new URLSearchParams(e).get("tgWebAppData")},ft=a({viewport:void 0,theme:void 0,init:void 0}),yt=e=>{const[t,a]=r({viewport:void 0,theme:void 0,init:void 0});return o((()=>{const e=()=>{a("init",ke())};e();const t=t=>{e(),a("viewport",{...t,safe_area_bottom:t.is_expanded&&t.is_state_stable?window.outerHeight-t.height:0})};wt(gt,t),G();const o=t=>{e(),a("theme",t)};return wt(ct,o),G(),s((()=>{mt(gt,t),mt(ct,o)})),()=>{mt(gt,t),mt(ct,o)}})),ft.Provider({value:t,children:e.children})};export{ft as ContextTwa,et as EventBackButtonPressed,tt as EventClipboardTextReceived,st as EventCustomMethodInvoked,at as EventInvoiceClosed,ot as EventMainButtonPressed,rt as EventPhoneRequested,nt as EventPopupClosed,pt as EventQrTextReceived,it as EventReloadIframe,ut as EventScanQrPopupClosed,_t as EventSetCustomStyle,dt as EventSettingsButtonPressed,ct as EventThemeChanged,gt as EventViewportChanged,lt as EventWriteAccessRequested,Ze as Method,Be as MethodClose,Ce as MethodCloseScanQrPopup,Ie as MethodDataSend,Te as MethodExpand,Le as MethodIframeReady,We as MethodIframeWillReload,Pe as MethodInvokeCustomMethod,Ne as MethodOpenInvoice,De as MethodOpenLink,Ee as MethodOpenPopup,Re as MethodOpenScanQrPopup,Me as MethodOpenTgLink,Oe as MethodReadTextFromClipboard,Qe as MethodReady,xe as MethodRequestPhone,Ae as MethodRequestTheme,He as MethodRequestViewport,Je as MethodRequestWriteAccess,$e as MethodSetBackgroundColor,Fe as MethodSetBottomBarColor,je as MethodSetHeaderColor,Ue as MethodSetupBackButton,Ve as MethodSetupClosingBehavior,Ge as MethodSetupMainButton,ze as MethodSetupSettingsButton,Ye as MethodSetupSwipeBehavior,Ke as MethodSwitchInlineQuery,Xe as MethodTriggerHapticFeedback,d as NOT_SUPPORTED,yt as ProviderTWA,u as TG_DESKTOP,p as TG_PHONE,i as TG_WEB,w as bridgeClose,h as bridgeCloseScanQrPopup,v as bridgeDataSend,y as bridgeExpand,ke as bridgeGetInitData,b as bridgeGetThemeParams,q as bridgeIframeReady,R as bridgeIframeWillReload,x as bridgeInvokeCustomMethod,C as bridgeOpenInvoice,T as bridgeOpenLink,W as bridgeOpenPopup,D as bridgeOpenScanQrPopup,M as bridgeOpenTgLink,A as bridgeReadTextFromClipboard,J as bridgeReady,j as bridgeRequestPhone,U as bridgeRequestTheme,G as bridgeRequestViewport,K as bridgeRequestWriteAccess,qe as bridgeSend,he as bridgeSessionStorageGet,we as bridgeSessionStorageSet,Y as bridgeSetBackgroundColor,se as bridgeSetBottomBarColor,ee as bridgeSetHeaderColor,oe as bridgeSetupBackButton,ne as bridgeSetupClosingBehavior,pe as bridgeSetupMainButton,_e as bridgeSetupSettingsButton,ve as bridgeSetupSwipeBehavior,ce as bridgeSwitchInlineQuery,le as bridgeTriggerHapticFeedback,n as createIsViewportChanged,ye as debug,vt as getAppData,_ as getPlatform,St as listener,qe as sender,m as supportClose,S as supportCloseScanQrPopup,f as supportDataSend,k as supportExpand,P as supportIframeReady,O as supportIframeWillReload,B as supportInvokeCustomMethod,I as supportOpenInvoice,L as supportOpenLink,N as supportOpenPopup,E as supportOpenScanQrPopup,Q as supportOpenTgLink,H as supportReadTextFromClipboard,$ as supportReady,F as supportRequestPhone,V as supportRequestTheme,z as supportRequestViewport,X as supportRequestWriteAccess,Se as supportSessionStorageGet,me as supportSessionStorageSet,Z as supportSetBackgroundColor,ae as supportSetBottomBarColor,te as supportSetHeaderColor,re as supportSetupBackButton,ie as supportSetupClosingBehavior,ue as supportSetupMainButton,de as supportSetupSettingsButton,fe as supportSetupSwipeBehavior,ge as supportSwitchInlineQuery,be as supportTriggerHapticFeedback};
