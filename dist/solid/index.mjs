import e from"debug";import{createSignal as t,onMount as s,onCleanup as a}from"solid-js";const r=()=>{const[e,r]=t({height:0,is_expanded:!1,is_state_stable:!1}),o=e=>r(e);return s((()=>{Ee(Ce,o),he(tt)})),a((()=>{De(Ce,o)})),e},o="web",n="phone",i="desktop",_=()=>{const e=window.location.hash.slice(1),t=new URLSearchParams(e).get("tgWebAppPlatform")??"ios";return["android","ios"].includes(t)?n:["tdesktop","macos"].includes(t)?i:o},p="not_supported",u=(e,t)=>{const s=new URLSearchParams(window.location.hash.slice(1)).get("tgWebAppVersion");return Number(s)>=e&&-1!==t.indexOf(_())},d=()=>Math.random().toString(36).substring(3,9),c=e=>{var t;if(t=/^\s*#([0-9a-f]{6})\s*$/i.exec(e+=""))return"#"+t[1].toLowerCase();if(t=/^\s*#([0-9a-f])([0-9a-f])([0-9a-f])\s*$/i.exec(e))return("#"+t[1]+t[1]+t[2]+t[2]+t[3]+t[3]).toLowerCase();if(t=/^\s*rgba?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*(\d+\.{0,1}\d*))?\)\s*$/.exec(e)){var s=parseInt(t[1]),a=parseInt(t[2]),r=parseInt(t[3]);return"#"+((s<16?"0":"")+s.toString(16))+((a<16?"0":"")+a.toString(16))+((r<16?"0":"")+r.toString(16))}return!1},g=()=>b()?(he(Ge),{status:!0}):(we(Ge,1),{status:p}),b=()=>u(0,[o,i,n]),l=()=>w()?(he(Ve),{status:!0}):(we(Ve,1),{status:p}),w=()=>u(6.4,[n]),m=e=>h()?(he(Qe,e),{status:!0}):(we(Qe,1),{status:p}),h=()=>u(0,[o,i,n]),f=()=>v()?(he(je),{status:!0}):(we(je,1),{status:p}),v=()=>u(0,[n]),y=e=>S()?(he(Fe,e),{status:!0}):(we(Fe,1),{status:p}),S=()=>u(0,[o]),q=()=>x()?(he(Fe),{status:!0}):(we(Fe,1),{status:p}),x=()=>u(0,[o]),k="web_app_invoke_custom_method",P=async e=>O()?(void 0===e.req_id&&(e.req_id=d()),he(k,e),new Promise(((t,s)=>{const a=s=>{s.req_id===e.req_id&&(t({status:!0,data:s}),De(ye,a))};Ee(ye,a)}))):(we(k,1),{status:p}),O=()=>u(6.9,[o,i,n]),I=e=>R()?(he(ze,e),{status:!0}):(we(ze,1),{status:p}),R=()=>u(6.1,[o,i,n]),T=e=>N()?(he(Ke,e),{status:!0}):(we(Ke,1),{status:p}),N=()=>u(6.4,[o,i,n]),C=async e=>L()?(e.title.length>64&&we(Xe,3),e.message.length<1&&we(Xe,4),e.message.length>256&&we(Xe,5),e.buttons.length<1&&we(Xe,6),e.buttons.length>3&&we(Xe,7),void 0!==e.buttons.find((e=>e.text?.match(/^(ok|close|cancel)$/g)))&&we(Xe,8),he(Xe,e),new Promise(((t,s)=>{const a=s=>{t({status:!!e.buttons.find((e=>e.id===s?.button_id)),data:s}),De(ke,a)};Ee(ke,a)}))):(we(Xe,1),{status:p}),L=()=>u(6.2,[o,i,n]),W=async e=>E()?(he(Me,e),new Promise(((t,s)=>{Je(Oe,(s=>{e.is_close&&l(),t({status:!0,data:s})})),Je(Ie,(()=>{t({status:"closed"})}))}))):(we(Me,1),{status:p}),E=()=>u(6.4,[n]),D=e=>("/"!==e.path_full[0]&&(e.path_full="/"+e.path_full),J()?(he(Ye,e),{status:!0}):(we(Ye,1),{status:p})),J=()=>u(7,[o,i,n]),$=async e=>B()?(void 0===e.req_id&&(e.req_id=d()),he(Ae,e),new Promise(((t,s)=>{const a=s=>{s.req_id===e.req_id&&(t({status:!0,data:s}),De(ve,a))};Ee(ve,a)}))):(we(Ae,1),{status:p}),B=()=>u(6.4,[o,i,n]),M=()=>A()?(he(Ze),{status:!0}):(we(Ze,1),{status:p}),A=()=>u(6.9,[o,i,n]),U=async()=>G()?(he(Ue),new Promise(((e,t)=>{Je(xe,(t=>{"sent"===t.status&&e({status:!0}),e({status:!1})}))}))):(we(Ue,1),{status:p}),G=()=>u(6.9,[o,i,n]),V=()=>Q()?(he(et),{status:!0}):(we(et,1),{status:p}),Q=()=>u(0,[o,i,n]),j=()=>F()?(he(tt),{status:!0}):(we(tt,1),{status:p}),F=()=>u(0,[o,i,n]),H=()=>z()?(he(st),{status:!0}):(we(st,1),{status:p}),z=()=>u(6.9,[o,i,n]),K=e=>X()?(he(at,e),{status:!0}):(we(at,1),{status:p}),X=()=>u(6.1,[o,i,n]),Y=e=>Z()?(he(rt,e),{status:!0}):(we(rt,1),{status:p}),Z=()=>u(6.1,[o,i,n]),ee=e=>te()?(he(ot,e),{status:!0}):(we(ot,1),{status:p}),te=()=>u(6.1,[o,i,n]),se=e=>ae()?(he(nt,e),{status:!0}):(we(nt,1),{status:p}),ae=()=>u(0,[o,i,n]),re=e=>oe()?(he(it,e),{status:!0}):(we(it,1),{status:p}),oe=()=>u(0,[o,i,n]),ne=e=>ie()?(he(_t,e),{status:!0}):(we(_t,1),{status:p}),ie=()=>u(6.1,[o,i,n]),_e=e=>pe()?(e.query.length>256&&we(pt,9),he(pt,e),{status:!0}):(we(pt,1),{status:p}),pe=()=>u(6.7,[o,i,n]),ue=e=>de()?(he(ut,e),{status:!0}):(we(ut,1),{status:p}),de=()=>u(6.1,[n]),ce=({key:e,value:t})=>{try{return window.sessionStorage.setItem("__telegram__"+e,JSON.stringify(t)),{status:!0}}catch(e){}return{status:!1}},ge=()=>!0,be=({key:e})=>{try{return{value:JSON.parse(window.sessionStorage.getItem("__telegram__"+e)??""),status:!0}}catch(e){}return{status:!1}},le=()=>!0;var we=(e,t)=>{"development"===process.env.NODE_ENV&&console.error(`[@apiteam/twa-bridge](${e}) = ${t}`)};const me=()=>{const e=new URLSearchParams(window.location.hash.slice(1)).get("tgWebAppData");if(null===e)return we("getInitData",2),null;const t=new URLSearchParams(e);let s={};return t.forEach(((e,t)=>{if(s[t]=e,void 0!==t.match(/^(chat|receiver|user)$/g))try{s[t]=JSON.parse(e)}catch{}})),s};var he=(t,s)=>{if(window.TelegramWebviewProxy)window.TelegramWebviewProxy.postEvent(t,JSON.stringify(s));else if(window.external&&"notify"in window.external)window.external.notify(JSON.stringify({eventType:t,eventData:s}));else try{"*",window.parent.postMessage(JSON.stringify({eventType:t,eventData:s}),"*")}catch(t){e("postMessage Iframe",10)}};const fe="back_button_pressed",ve="clipboard_text_received",ye="custom_method_invoked",Se="invoice_closed",qe="main_button_pressed",xe="phone_requested",ke="popup_closed",Pe="reload_iframe",Oe="qr_text_received",Ie="scan_qr_popup_closed",Re="set_custom_style",Te="settings_button_pressed",Ne="theme_changed",Ce="viewport_changed",Le="write_access_requested",We=((e=new Map)=>({once:(t,s,a=e.get(t),r=(e=>{s(e),a&&a.splice(a.indexOf(s)>>>0,1)}))=>a?a.push(r):e.set(t,[r]),on:(t,s,a=e.get(t))=>a?a.push(s):e.set(t,[s]),off:(t,s,a=e.get(t))=>a&&s?a.splice(a.indexOf(s)>>>0,1):e.set(t,[]),emit:(t,s,a=e.get(t)||[])=>{for(const e of a)e(s)}}))();(()=>{function e(e,t){e===Ne&&(t.theme_params=(e=>{"#1c1c1d"==e.bg_color&&e.bg_color==e.secondary_bg_color&&(e.secondary_bg_color="#2c2c2e");const t=window.location.hash.slice(1),s=new URLSearchParams(t);var a=JSON.parse(s.get("tgWebAppThemeParams")??"");for(var r in e){var o=c(e[r]);"string"==typeof o&&(a[r]=o)}return a})(t.theme_params)),We.emit(e,t),We.emit("*",{name:e,data:t})}window.TelegramGameProxy_receiveEvent=e,window.Telegram={WebView:{receiveEvent:e}},window.TelegramGameProxy={receiveEvent:e}})();const Ee=(e,t)=>{We.on(e,t)},De=(e,t)=>{We.off(e,t)},Je=(e,t)=>{We.once(e,t)};var $e=Object.freeze({__proto__:null,off:De,on:Ee,once:Je});const Be="web_app_invoke_custom_method",Me="web_app_open_scan_qr_popup",Ae="web_app_read_text_from_clipboard",Ue="web_app_request_phone",Ge="web_app_close",Ve="web_app_close_scan_qr_popup",Qe="web_app_data_send",je="web_app_expand",Fe="iframe_ready",He="iframe_will_reload",ze="web_app_open_invoice",Ke="web_app_open_link",Xe="web_app_open_popup",Ye="web_app_open_tg_link",Ze="web_app_ready",et="web_app_request_theme",tt="web_app_request_viewport",st="web_app_request_write_access",at="web_app_set_background_color",rt="web_app_set_header_color",ot="web_app_setup_back_button",nt="web_app_setup_closing_behavior",it="web_app_setup_main_button",_t="web_app_setup_settings_button",pt="web_app_switch_inline_query",ut="web_app_trigger_haptic_feedback";export{fe as EventBackButtonPressed,ve as EventClipboardTextReceived,ye as EventCustomMethodInvoked,Se as EventInvoiceClosed,qe as EventMainButtonPressed,xe as EventPhoneRequested,ke as EventPopupClosed,Oe as EventQrTextReceived,Pe as EventReloadIframe,Ie as EventScanQrPopupClosed,Re as EventSetCustomStyle,Te as EventSettingsButtonPressed,Ne as EventThemeChanged,Ce as EventViewportChanged,Le as EventWriteAccessRequested,Ge as MethodClose,Ve as MethodCloseScanQrPopup,Qe as MethodDataSend,je as MethodExpand,Fe as MethodIframeReady,He as MethodIframeWillReload,Be as MethodInvokeCustomMethod,ze as MethodOpenInvoice,Ke as MethodOpenLink,Xe as MethodOpenPopup,Me as MethodOpenScanQrPopup,Ye as MethodOpenTgLink,Ae as MethodReadTextFromClipboard,Ze as MethodReady,Ue as MethodRequestPhone,et as MethodRequestTheme,tt as MethodRequestViewport,st as MethodRequestWriteAccess,at as MethodSetBackgroundColor,rt as MethodSetHeaderColor,ot as MethodSetupBackButton,nt as MethodSetupClosingBehavior,it as MethodSetupMainButton,_t as MethodSetupSettingsButton,pt as MethodSwitchInlineQuery,ut as MethodTriggerHapticFeedback,p as NOT_SUPPORTED,i as TG_DESKTOP,n as TG_PHONE,o as TG_WEB,g as bridgeClose,l as bridgeCloseScanQrPopup,m as bridgeDataSend,f as bridgeExpand,me as bridgeGetInitData,y as bridgeIframeReady,q as bridgeIframeWillReload,P as bridgeInvokeCustomMethod,I as bridgeOpenInvoice,T as bridgeOpenLink,C as bridgeOpenPopup,W as bridgeOpenScanQrPopup,D as bridgeOpenTgLink,$ as bridgeReadTextFromClipboard,M as bridgeReady,U as bridgeRequestPhone,V as bridgeRequestTheme,j as bridgeRequestViewport,H as bridgeRequestWriteAccess,be as bridgeSessionStorageGet,ce as bridgeSessionStorageSet,K as bridgeSetBackgroundColor,Y as bridgeSetHeaderColor,ee as bridgeSetupBackButton,se as bridgeSetupClosingBehavior,re as bridgeSetupMainButton,ne as bridgeSetupSettingsButton,_e as bridgeSwitchInlineQuery,ue as bridgeTriggerHapticFeedback,r as createIsViewportChanged,we as debug,_ as getPlatform,$e as listener,he as sender,b as supportClose,w as supportCloseScanQrPopup,h as supportDataSend,v as supportExpand,S as supportIframeReady,x as supportIframeWillReload,O as supportInvokeCustomMethod,R as supportOpenInvoice,N as supportOpenLink,L as supportOpenPopup,E as supportOpenScanQrPopup,J as supportOpenTgLink,B as supportReadTextFromClipboard,A as supportReady,G as supportRequestPhone,Q as supportRequestTheme,F as supportRequestViewport,z as supportRequestWriteAccess,le as supportSessionStorageGet,ge as supportSessionStorageSet,X as supportSetBackgroundColor,Z as supportSetHeaderColor,te as supportSetupBackButton,ae as supportSetupClosingBehavior,oe as supportSetupMainButton,ie as supportSetupSettingsButton,pe as supportSwitchInlineQuery,de as supportTriggerHapticFeedback};
