import{createSignal as e,onMount as t,onCleanup as s,createContext as a,createEffect as r}from"solid-js";import{createStore as o}from"solid-js/store";const i=()=>{const[a,r]=e({height:0,is_expanded:!1,is_state_stable:!1}),o=e=>r(e);return t((()=>{lt(ct,o),xe(Ae)})),s((()=>{wt(ct,o)})),a},n="web",_="phone",p="desktop",d=()=>{const e=window.location.hash.slice(1),t=new URLSearchParams(e).get("tgWebAppPlatform")??"ios";return["android","ios"].includes(t)?_:["tdesktop","macos"].includes(t)?p:n},u="not_supported",c=(e,t)=>{const s=new URLSearchParams(window.location.hash.slice(1)).get("tgWebAppVersion");return Number(s?.replace(".",""))>=Number(String(e)?.replace(".",""))&&-1!==t.indexOf(d())},g=()=>Math.random().toString(36).substring(3,9),b=e=>{var t;if(t=/^\s*#([0-9a-f]{6})\s*$/i.exec(e+=""))return"#"+t[1].toLowerCase();if(t=/^\s*#([0-9a-f])([0-9a-f])([0-9a-f])\s*$/i.exec(e))return("#"+t[1]+t[1]+t[2]+t[2]+t[3]+t[3]).toLowerCase();if(t=/^\s*rgba?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*(\d+\.{0,1}\d*))?\)\s*$/.exec(e)){var s=parseInt(t[1]),a=parseInt(t[2]),r=parseInt(t[3]);return"#"+((s<16?"0":"")+s.toString(16))+((a<16?"0":"")+a.toString(16))+((r<16?"0":"")+r.toString(16))}return!1},l=e=>{const t=window.location.hash.slice(1),s=new URLSearchParams(t),a=JSON.parse(s.get("tgWebAppThemeParams")??""),r=e||a;for(var o of Object.keys(r)){var i=b(r[o]);"string"==typeof i&&(r[o]=i)}return"#1c1c1d"==r?.bg_color&&r?.bg_color==r?.secondary_bg_color&&(r.secondary_bg_color="#2c2c2e"),r},w=e=>m()?(xe(Re,e),{status:!0}):(ye(Re,1),{status:u}),m=()=>c(0,[n,p,_]),h=e=>v()?(xe(Te,e),{status:!0}):(ye(Te,1),{status:u}),v=()=>c(6.4,[_]),f=e=>S()?(xe(Ne,e),{status:!0}):(ye(Ne,1),{status:u}),S=()=>c(0,[n,p,_]),y=e=>q()?(xe(Ce,e),{status:!0}):(ye(Ce,1),{status:u}),q=()=>c(0,[_]),x=e=>P()?(xe(Le,e),{status:!0}):(ye(Le,1),{status:u}),P=()=>c(0,[n]),k=()=>O()?(xe(Le),{status:!0}):(ye(Le,1),{status:u}),O=()=>c(0,[n]),I=async e=>R()?(void 0===e.req_id&&(e.req_id=g()),xe(Pe,e),new Promise(((t,s)=>{const a=s=>{s.req_id===e.req_id&&(t({status:!0,data:s}),wt(tt,a))};lt(tt,a)}))):(ye(Pe,1),{status:u}),R=()=>c(6.9,[n,p,_]),T=e=>N()?(xe(Be,e),{status:!0}):(ye(Be,1),{status:u}),N=()=>c(6.1,[n,p,_]),C=e=>L()?(xe(De,e),{status:!0}):(ye(De,1),{status:u}),L=()=>c(6.4,[n,p,_]),W=async e=>B()?(e.title.length>64&&ye(Ee,3),e.message.length<1&&ye(Ee,4),e.message.length>256&&ye(Ee,5),e.buttons.length<1&&ye(Ee,6),e.buttons.length>3&&ye(Ee,7),void 0!==e.buttons.find((e=>e.text?.match(/^(ok|close|cancel)$/g)))&&ye(Ee,8),xe(Ee,e),new Promise(((t,s)=>{const a=s=>{t({status:!!e.buttons.find((e=>e.id===s?.button_id)),data:s}),wt(ot,a)};lt(ot,a)}))):(ye(Ee,1),{status:u}),B=()=>c(6.2,[n,p,_]),D=async e=>E()?(xe(ke,e),new Promise(((t,s)=>{mt(nt,(s=>{e.is_close&&h(),t({status:!0,data:s})})),mt(_t,(()=>{t({status:"closed"})}))}))):(ye(ke,1),{status:u}),E=()=>c(6.4,[_]),J=e=>("/"!==e.path_full[0]&&(e.path_full="/"+e.path_full),$()?(xe(Je,e),{status:!0}):(ye(Je,1),{status:u})),$=()=>c(7,[n,p,_]),j=async e=>A()?(e||(e={req_id:void 0}),void 0===e.req_id&&(e.req_id=g()),xe(Oe,e),new Promise(((t,s)=>{const a=s=>{s.req_id===e?.req_id&&(t({status:!0,data:s}),wt(et,a))};lt(et,a)}))):(ye(Oe,1),{status:u}),A=()=>c(6.4,[n,p,_]),M=e=>U()?(xe($e,e),{status:!0}):(ye($e,1),{status:u}),U=()=>c(6.9,[n,p,_]),G=async()=>V()?(xe(Ie),new Promise(((e,t)=>{mt(rt,(t=>{"sent"===t.status&&e({status:!0}),e({status:!1})}))}))):(ye(Ie,1),{status:u}),V=()=>c(6.9,[n,p,_]),H=e=>Q()?(xe(je,e),{status:!0}):(ye(je,1),{status:u}),Q=()=>c(0,[n,p,_]),F=e=>z()?(xe(Ae,e),{status:!0}):(ye(Ae,1),{status:u}),z=()=>c(0,[n,p,_]),K=()=>X()?(xe(Me),{status:!0}):(ye(Me,1),{status:u}),X=()=>c(6.9,[n,p,_]),Y=e=>Z()?(xe(Ue,e),{status:!0}):(ye(Ue,1),{status:u}),Z=()=>c(6.1,[n,p,_]),ee=e=>te()?(xe(Ge,e),{status:!0}):(ye(Ge,1),{status:u}),te=()=>c(6.1,[n,p,_]),se=e=>ae()?(xe(Ve,{color:e?.color||e?.color_key}),{status:!0}):(ye(Ve,1),{status:u}),ae=()=>c(710,[n,p,_]),re=e=>oe()?(xe(He,e),{status:!0}):(ye(He,1),{status:u}),oe=()=>c(6.1,[n,p,_]),ie=e=>ne()?(xe(Qe,e),{status:!0}):(ye(Qe,1),{status:u}),ne=()=>c(0,[n,p,_]),_e=e=>pe()?(xe(Fe,e),{status:!0}):(ye(Fe,1),{status:u}),pe=()=>c(0,[n,p,_]),de=e=>ue()?(xe(ze,e),{status:!0}):(ye(ze,1),{status:u}),ue=()=>c(6.1,[n,p,_]),ce=e=>ge()?(e.query.length>256&&ye(Ke,9),xe(Ke,e),{status:!0}):(ye(Ke,1),{status:u}),ge=()=>c(6.7,[n,p,_]),be=e=>le()?(xe(Xe,e),{status:!0}):(ye(Xe,1),{status:u}),le=()=>c(6.1,[_]),we=({key:e,value:t})=>{try{return window.sessionStorage.setItem("__telegram__"+e,JSON.stringify(t)),{status:!0}}catch(s){return window.sessionStorage.setItem("__telegram__"+e,t),{status:!0}}},me=()=>!0,he=({key:e})=>{try{return{is_json:!0,value:JSON.parse(window.sessionStorage.getItem("__telegram__"+e)??""),status:!0}}catch(t){return{is_json:!1,value:window.sessionStorage.getItem("__telegram__"+e)??"",status:!0}}},ve=()=>!0,fe=e=>Se()?(xe(Ye,e),{status:!0}):(ye(Ye,1),{status:u}),Se=()=>c(7.7,[n,p,_]);var ye=(e,t)=>{"development"===process.env.NODE_ENV&&console.error(`[@apiteam/twa-bridge](${e}) = ${t}`)};const qe=()=>{const e=window.location.hash.slice(1),t=new URLSearchParams(e).get("tgWebAppData");if(!t)return void ye("getInitData",2);const s=new URLSearchParams(t);let a={};return s.forEach(((e,t)=>{if(a[t]=e,void 0!==t.match(/^(chat|receiver|user)$/g))try{a[t]=JSON.parse(e)}catch{}})),a};var xe=(e,t)=>{if(window.TelegramWebviewProxy)window.TelegramWebviewProxy.postEvent(e,JSON.stringify(t));else if(window.external&&"notify"in window.external)window.external.notify(JSON.stringify({eventType:e,eventData:t}));else try{"*",window.parent.postMessage(JSON.stringify({eventType:e,eventData:t}),"*")}catch(e){ye("postMessage Iframe",10)}};const Pe="web_app_invoke_custom_method",ke="web_app_open_scan_qr_popup",Oe="web_app_read_text_from_clipboard",Ie="web_app_request_phone",Re="web_app_close",Te="web_app_close_scan_qr_popup",Ne="web_app_data_send",Ce="web_app_expand",Le="iframe_ready",We="iframe_will_reload",Be="web_app_open_invoice",De="web_app_open_link",Ee="web_app_open_popup",Je="web_app_open_tg_link",$e="web_app_ready",je="web_app_request_theme",Ae="web_app_request_viewport",Me="web_app_request_write_access",Ue="web_app_set_background_color",Ge="web_app_set_header_color",Ve="web_app_set_bottom_bar_color",He="web_app_setup_back_button",Qe="web_app_setup_closing_behavior",Fe="web_app_setup_main_button",ze="web_app_setup_settings_button",Ke="web_app_switch_inline_query",Xe="web_app_trigger_haptic_feedback",Ye="web_app_setup_swipe_behavior";const Ze="back_button_pressed",et="clipboard_text_received",tt="custom_method_invoked",st="invoice_closed",at="main_button_pressed",rt="phone_requested",ot="popup_closed",it="reload_iframe",nt="qr_text_received",_t="scan_qr_popup_closed",pt="set_custom_style",dt="settings_button_pressed",ut="theme_changed",ct="viewport_changed",gt="write_access_requested",bt=((e=new Map)=>({once:(t,s,a=e.get(t),r=(e=>{s(e),a&&a.splice(a.indexOf(s)>>>0,1)}))=>a?a.push(r):e.set(t,[r]),on:(t,s,a=e.get(t))=>a?a.push(s):e.set(t,[s]),off:(t,s,a=e.get(t))=>a&&s?a.splice(a.indexOf(s)>>>0,1):e.set(t,[]),emit:(t,s,a=e.get(t)||[])=>{for(const e of a)e(s)}}))();(()=>{function e(e,t){e===ut&&(t.theme_params=l(t.theme_params)),bt.emit(e,t),bt.emit("*",{name:e,data:t})}window.TelegramGameProxy_receiveEvent=e,window.Telegram={WebView:{receiveEvent:e}},window.TelegramGameProxy={receiveEvent:e}})();const lt=(e,t)=>{bt.on(e,t)},wt=(e,t)=>{bt.off(e,t)},mt=(e,t)=>{bt.once(e,t)};var ht=Object.freeze({__proto__:null,off:wt,on:lt,once:mt});const vt=()=>{const e=window.location.hash.slice(1);return new URLSearchParams(e).get("tgWebAppData")},ft=a({viewport:void 0,theme:void 0,init:void 0}),St=e=>{const[t,a]=o({viewport:void 0,theme:void 0,init:void 0});return r((()=>{const e=()=>{a("init",qe())};e();const t=t=>{e(),a("viewport",{...t,safe_area_bottom:t.is_expanded&&t.is_state_stable?window.outerHeight-t.height:0})};lt(ct,t),F();const r=t=>{e(),a("theme",t)};return lt(ut,r),F(),s((()=>{wt(ct,t),wt(ut,r)})),()=>{wt(ct,t),wt(ut,r)}})),ft.Provider({value:t,children:e.children})};export{ft as ContextTwa,Ze as EventBackButtonPressed,et as EventClipboardTextReceived,tt as EventCustomMethodInvoked,st as EventInvoiceClosed,at as EventMainButtonPressed,rt as EventPhoneRequested,ot as EventPopupClosed,nt as EventQrTextReceived,it as EventReloadIframe,_t as EventScanQrPopupClosed,pt as EventSetCustomStyle,dt as EventSettingsButtonPressed,ut as EventThemeChanged,ct as EventViewportChanged,gt as EventWriteAccessRequested,Re as MethodClose,Te as MethodCloseScanQrPopup,Ne as MethodDataSend,Ce as MethodExpand,Le as MethodIframeReady,We as MethodIframeWillReload,Pe as MethodInvokeCustomMethod,Be as MethodOpenInvoice,De as MethodOpenLink,Ee as MethodOpenPopup,ke as MethodOpenScanQrPopup,Je as MethodOpenTgLink,Oe as MethodReadTextFromClipboard,$e as MethodReady,Ie as MethodRequestPhone,je as MethodRequestTheme,Ae as MethodRequestViewport,Me as MethodRequestWriteAccess,Ue as MethodSetBackgroundColor,Ve as MethodSetBottomBarColor,Ge as MethodSetHeaderColor,He as MethodSetupBackButton,Qe as MethodSetupClosingBehavior,Fe as MethodSetupMainButton,ze as MethodSetupSettingsButton,Ye as MethodSetupSwipeBehavior,Ke as MethodSwitchInlineQuery,Xe as MethodTriggerHapticFeedback,u as NOT_SUPPORTED,St as ProviderTWA,p as TG_DESKTOP,_ as TG_PHONE,n as TG_WEB,w as bridgeClose,h as bridgeCloseScanQrPopup,f as bridgeDataSend,y as bridgeExpand,qe as bridgeGetInitData,l as bridgeGetThemeParams,x as bridgeIframeReady,k as bridgeIframeWillReload,I as bridgeInvokeCustomMethod,T as bridgeOpenInvoice,C as bridgeOpenLink,W as bridgeOpenPopup,D as bridgeOpenScanQrPopup,J as bridgeOpenTgLink,j as bridgeReadTextFromClipboard,M as bridgeReady,G as bridgeRequestPhone,H as bridgeRequestTheme,F as bridgeRequestViewport,K as bridgeRequestWriteAccess,xe as bridgeSend,he as bridgeSessionStorageGet,we as bridgeSessionStorageSet,Y as bridgeSetBackgroundColor,se as bridgeSetBottomBarColor,ee as bridgeSetHeaderColor,re as bridgeSetupBackButton,ie as bridgeSetupClosingBehavior,_e as bridgeSetupMainButton,de as bridgeSetupSettingsButton,fe as bridgeSetupSwipeBehavior,ce as bridgeSwitchInlineQuery,be as bridgeTriggerHapticFeedback,i as createIsViewportChanged,ye as debug,vt as getAppData,d as getPlatform,ht as listener,xe as sender,m as supportClose,v as supportCloseScanQrPopup,S as supportDataSend,q as supportExpand,P as supportIframeReady,O as supportIframeWillReload,R as supportInvokeCustomMethod,N as supportOpenInvoice,L as supportOpenLink,B as supportOpenPopup,E as supportOpenScanQrPopup,$ as supportOpenTgLink,A as supportReadTextFromClipboard,U as supportReady,V as supportRequestPhone,Q as supportRequestTheme,z as supportRequestViewport,X as supportRequestWriteAccess,ve as supportSessionStorageGet,me as supportSessionStorageSet,Z as supportSetBackgroundColor,ae as supportSetBottomBarColor,te as supportSetHeaderColor,oe as supportSetupBackButton,ne as supportSetupClosingBehavior,pe as supportSetupMainButton,ue as supportSetupSettingsButton,Se as supportSetupSwipeBehavior,ge as supportSwitchInlineQuery,le as supportTriggerHapticFeedback};
