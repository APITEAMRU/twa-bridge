"use strict";var e=require("debug"),t=require("solid-js");const s="web",o="phone",r="desktop",p=()=>{const e=window.location.hash.slice(1),t=new URLSearchParams(e).get("tgWebAppPlatform")??"ios";return["android","ios"].includes(t)?o:["tdesktop","macos"].includes(t)?r:s},a="not_supported",n=(e,t)=>{const s=new URLSearchParams(window.location.hash.slice(1)).get("tgWebAppVersion");return Number(s?.replace(".",""))>=Number(String(e)?.replace(".",""))&&-1!==t.indexOf(p())},i=()=>Math.random().toString(36).substring(3,9),u=e=>{var t;if(t=/^\s*#([0-9a-f]{6})\s*$/i.exec(e+=""))return"#"+t[1].toLowerCase();if(t=/^\s*#([0-9a-f])([0-9a-f])([0-9a-f])\s*$/i.exec(e))return("#"+t[1]+t[1]+t[2]+t[2]+t[3]+t[3]).toLowerCase();if(t=/^\s*rgba?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*(\d+\.{0,1}\d*))?\)\s*$/.exec(e)){var s=parseInt(t[1]),o=parseInt(t[2]),r=parseInt(t[3]);return"#"+((s<16?"0":"")+s.toString(16))+((o<16?"0":"")+o.toString(16))+((r<16?"0":"")+r.toString(16))}return!1},d=()=>n(0,[s,r,o]),_=()=>c()?(G(pe),{status:!0}):(A(pe,1),{status:a}),c=()=>n(6.4,[o]),x=()=>n(0,[s,r,o]),l=()=>n(0,[o]),g=()=>n(0,[s]),b=()=>n(0,[s]),h="web_app_invoke_custom_method",w=()=>n(6.9,[s,r,o]),m=()=>n(6.1,[s,r,o]),S=()=>n(6.4,[s,r,o]),v=()=>n(6.2,[s,r,o]),f=()=>n(6.4,[o]),y=()=>n(7,[s,r,o]),M=()=>n(6.4,[s,r,o]),P=()=>n(6.9,[s,r,o]),q=()=>n(6.9,[s,r,o]),C=()=>n(0,[s,r,o]),k=()=>n(0,[s,r,o]),R=()=>n(6.9,[s,r,o]),B=()=>n(6.1,[s,r,o]),O=()=>n(6.1,[s,r,o]),E=()=>n(710,[s,r,o]),T=()=>n(6.1,[s,r,o]),I=()=>n(0,[s,r,o]),W=()=>n(0,[s,r,o]),L=()=>n(6.1,[s,r,o]),N=()=>n(6.7,[s,r,o]),D=()=>n(6.1,[o]),Q=()=>n(7.7,[s,r,o]);var A=(e,t)=>{"development"===process.env.NODE_ENV&&console.error(`[@apiteam/twa-bridge](${e}) = ${t}`)};var G=(t,s)=>{if(window.TelegramWebviewProxy)window.TelegramWebviewProxy.postEvent(t,JSON.stringify(s));else if(window.external&&"notify"in window.external)window.external.notify(JSON.stringify({eventType:t,eventData:s}));else try{"*",window.parent.postMessage(JSON.stringify({eventType:t,eventData:s}),"*")}catch(t){e("postMessage Iframe",10)}};const V="clipboard_text_received",H="custom_method_invoked",J="phone_requested",$="popup_closed",F="qr_text_received",U="scan_qr_popup_closed",j="theme_changed",z="viewport_changed",K=((e=new Map)=>({once:(t,s,o=e.get(t),r=(e=>{s(e),o&&o.splice(o.indexOf(s)>>>0,1)}))=>o?o.push(r):e.set(t,[r]),on:(t,s,o=e.get(t))=>o?o.push(s):e.set(t,[s]),off:(t,s,o=e.get(t))=>o&&s?o.splice(o.indexOf(s)>>>0,1):e.set(t,[]),emit:(t,s,o=e.get(t)||[])=>{for(const e of o)e(s)}}))();(()=>{function e(e,t){e===j&&(t.theme_params=(e=>{"#1c1c1d"==e.bg_color&&e.bg_color==e.secondary_bg_color&&(e.secondary_bg_color="#2c2c2e");const t=window.location.hash.slice(1),s=new URLSearchParams(t);var o=JSON.parse(s.get("tgWebAppThemeParams")??"");for(var r in e){var p=u(e[r]);"string"==typeof p&&(o[r]=p)}return o})(t.theme_params)),K.emit(e,t),K.emit("*",{name:e,data:t})}window.TelegramGameProxy_receiveEvent=e,window.Telegram={WebView:{receiveEvent:e}},window.TelegramGameProxy={receiveEvent:e}})();const X=(e,t)=>{K.on(e,t)},Y=(e,t)=>{K.off(e,t)},Z=(e,t)=>{K.once(e,t)};var ee=Object.freeze({__proto__:null,off:Y,on:X,once:Z});const te="web_app_open_scan_qr_popup",se="web_app_read_text_from_clipboard",oe="web_app_request_phone",re="web_app_close",pe="web_app_close_scan_qr_popup",ae="web_app_data_send",ne="web_app_expand",ie="iframe_ready",ue="web_app_open_invoice",de="web_app_open_link",_e="web_app_open_popup",ce="web_app_open_tg_link",xe="web_app_ready",le="web_app_request_theme",ge="web_app_request_viewport",be="web_app_request_write_access",he="web_app_set_background_color",we="web_app_set_header_color",me="web_app_set_bottom_bar_color",Se="web_app_setup_back_button",ve="web_app_setup_closing_behavior",fe="web_app_setup_main_button",ye="web_app_setup_settings_button",Me="web_app_switch_inline_query",Pe="web_app_trigger_haptic_feedback",qe="web_app_setup_swipe_behavior";exports.EventBackButtonPressed="back_button_pressed",exports.EventClipboardTextReceived=V,exports.EventCustomMethodInvoked=H,exports.EventInvoiceClosed="invoice_closed",exports.EventMainButtonPressed="main_button_pressed",exports.EventPhoneRequested=J,exports.EventPopupClosed=$,exports.EventQrTextReceived=F,exports.EventReloadIframe="reload_iframe",exports.EventScanQrPopupClosed=U,exports.EventSetCustomStyle="set_custom_style",exports.EventSettingsButtonPressed="settings_button_pressed",exports.EventThemeChanged=j,exports.EventViewportChanged=z,exports.EventWriteAccessRequested="write_access_requested",exports.MethodClose=re,exports.MethodCloseScanQrPopup=pe,exports.MethodDataSend=ae,exports.MethodExpand=ne,exports.MethodIframeReady=ie,exports.MethodIframeWillReload="iframe_will_reload",exports.MethodInvokeCustomMethod="web_app_invoke_custom_method",exports.MethodOpenInvoice=ue,exports.MethodOpenLink=de,exports.MethodOpenPopup=_e,exports.MethodOpenScanQrPopup=te,exports.MethodOpenTgLink=ce,exports.MethodReadTextFromClipboard=se,exports.MethodReady=xe,exports.MethodRequestPhone=oe,exports.MethodRequestTheme=le,exports.MethodRequestViewport=ge,exports.MethodRequestWriteAccess=be,exports.MethodSetBackgroundColor=he,exports.MethodSetBottomBarColor=me,exports.MethodSetHeaderColor=we,exports.MethodSetupBackButton=Se,exports.MethodSetupClosingBehavior=ve,exports.MethodSetupMainButton=fe,exports.MethodSetupSettingsButton=ye,exports.MethodSetupSwipeBehavior=qe,exports.MethodSwitchInlineQuery=Me,exports.MethodTriggerHapticFeedback=Pe,exports.NOT_SUPPORTED=a,exports.TG_DESKTOP=r,exports.TG_PHONE=o,exports.TG_WEB=s,exports.bridgeClose=()=>d()?(G(re),{status:!0}):(A(re,1),{status:a}),exports.bridgeCloseScanQrPopup=_,exports.bridgeDataSend=e=>x()?(G(ae,e),{status:!0}):(A(ae,1),{status:a}),exports.bridgeExpand=()=>l()?(G(ne),{status:!0}):(A(ne,1),{status:a}),exports.bridgeGetInitData=()=>{const e=window.location.hash.slice(1),t=new URLSearchParams(e).get("tgWebAppData");if(!t)return A("getInitData",2),null;const s=new URLSearchParams(t);let o={};return s.forEach(((e,t)=>{if(o[t]=e,void 0!==t.match(/^(chat|receiver|user)$/g))try{o[t]=JSON.parse(e)}catch{}})),o},exports.bridgeIframeReady=e=>g()?(G(ie,e),{status:!0}):(A(ie,1),{status:a}),exports.bridgeIframeWillReload=()=>b()?(G(ie),{status:!0}):(A(ie,1),{status:a}),exports.bridgeInvokeCustomMethod=async e=>w()?(void 0===e.req_id&&(e.req_id=i()),G(h,e),new Promise(((t,s)=>{const o=s=>{s.req_id===e.req_id&&(t({status:!0,data:s}),Y(H,o))};X(H,o)}))):(A(h,1),{status:a}),exports.bridgeOpenInvoice=e=>m()?(G(ue,e),{status:!0}):(A(ue,1),{status:a}),exports.bridgeOpenLink=e=>S()?(G(de,e),{status:!0}):(A(de,1),{status:a}),exports.bridgeOpenPopup=async e=>v()?(e.title.length>64&&A(_e,3),e.message.length<1&&A(_e,4),e.message.length>256&&A(_e,5),e.buttons.length<1&&A(_e,6),e.buttons.length>3&&A(_e,7),void 0!==e.buttons.find((e=>e.text?.match(/^(ok|close|cancel)$/g)))&&A(_e,8),G(_e,e),new Promise(((t,s)=>{const o=s=>{t({status:!!e.buttons.find((e=>e.id===s?.button_id)),data:s}),Y($,o)};X($,o)}))):(A(_e,1),{status:a}),exports.bridgeOpenScanQrPopup=async e=>f()?(G(te,e),new Promise(((t,s)=>{Z(F,(s=>{e.is_close&&_(),t({status:!0,data:s})})),Z(U,(()=>{t({status:"closed"})}))}))):(A(te,1),{status:a}),exports.bridgeOpenTgLink=e=>("/"!==e.path_full[0]&&(e.path_full="/"+e.path_full),y()?(G(ce,e),{status:!0}):(A(ce,1),{status:a})),exports.bridgeReadTextFromClipboard=async e=>M()?(void 0===e.req_id&&(e.req_id=i()),G(se,e),new Promise(((t,s)=>{const o=s=>{s.req_id===e.req_id&&(t({status:!0,data:s}),Y(V,o))};X(V,o)}))):(A(se,1),{status:a}),exports.bridgeReady=()=>P()?(G(xe),{status:!0}):(A(xe,1),{status:a}),exports.bridgeRequestPhone=async()=>q()?(G(oe),new Promise(((e,t)=>{Z(J,(t=>{"sent"===t.status&&e({status:!0}),e({status:!1})}))}))):(A(oe,1),{status:a}),exports.bridgeRequestTheme=()=>C()?(G(le),{status:!0}):(A(le,1),{status:a}),exports.bridgeRequestViewport=()=>k()?(G(ge),{status:!0}):(A(ge,1),{status:a}),exports.bridgeRequestWriteAccess=()=>R()?(G(be),{status:!0}):(A(be,1),{status:a}),exports.bridgeSessionStorageGet=({key:e})=>{try{return{value:JSON.parse(window.sessionStorage.getItem("__telegram__"+e)??""),status:!0}}catch(e){}return{status:!1}},exports.bridgeSessionStorageSet=({key:e,value:t})=>{try{return window.sessionStorage.setItem("__telegram__"+e,JSON.stringify(t)),{status:!0}}catch(e){}return{status:!1}},exports.bridgeSetBackgroundColor=e=>B()?(G(he,e),{status:!0}):(A(he,1),{status:a}),exports.bridgeSetBottomBarColor=e=>E()?(G(me,{color:e.color||e.color_key}),{status:!0}):(A(me,1),{status:a}),exports.bridgeSetHeaderColor=e=>O()?(G(we,e),{status:!0}):(A(we,1),{status:a}),exports.bridgeSetupBackButton=e=>T()?(G(Se,e),{status:!0}):(A(Se,1),{status:a}),exports.bridgeSetupClosingBehavior=e=>I()?(G(ve,e),{status:!0}):(A(ve,1),{status:a}),exports.bridgeSetupMainButton=e=>W()?(G(fe,e),{status:!0}):(A(fe,1),{status:a}),exports.bridgeSetupSettingsButton=e=>L()?(G(ye,e),{status:!0}):(A(ye,1),{status:a}),exports.bridgeSetupSwipeBehavior=e=>Q()?(G(qe,e),{status:!0}):(A(qe,1),{status:a}),exports.bridgeSwitchInlineQuery=e=>N()?(e.query.length>256&&A(Me,9),G(Me,e),{status:!0}):(A(Me,1),{status:a}),exports.bridgeTriggerHapticFeedback=e=>D()?(G(Pe,e),{status:!0}):(A(Pe,1),{status:a}),exports.createIsViewportChanged=()=>{const[e,s]=t.createSignal({height:0,is_expanded:!1,is_state_stable:!1}),o=e=>s(e);return t.onMount((()=>{X(z,o),G(ge)})),t.onCleanup((()=>{Y(z,o)})),e},exports.debug=A,exports.getPlatform=p,exports.listener=ee,exports.sender=G,exports.supportClose=d,exports.supportCloseScanQrPopup=c,exports.supportDataSend=x,exports.supportExpand=l,exports.supportIframeReady=g,exports.supportIframeWillReload=b,exports.supportInvokeCustomMethod=w,exports.supportOpenInvoice=m,exports.supportOpenLink=S,exports.supportOpenPopup=v,exports.supportOpenScanQrPopup=f,exports.supportOpenTgLink=y,exports.supportReadTextFromClipboard=M,exports.supportReady=P,exports.supportRequestPhone=q,exports.supportRequestTheme=C,exports.supportRequestViewport=k,exports.supportRequestWriteAccess=R,exports.supportSessionStorageGet=()=>!0,exports.supportSessionStorageSet=()=>!0,exports.supportSetBackgroundColor=B,exports.supportSetBottomBarColor=E,exports.supportSetHeaderColor=O,exports.supportSetupBackButton=T,exports.supportSetupClosingBehavior=I,exports.supportSetupMainButton=W,exports.supportSetupSettingsButton=L,exports.supportSetupSwipeBehavior=Q,exports.supportSwitchInlineQuery=N,exports.supportTriggerHapticFeedback=D;
