"use strict";var e=require("solid-js"),t=require("solid-js/store");const o="web",s="phone",r="desktop",p=()=>{const e=window.location.hash.slice(1),t=new URLSearchParams(e).get("tgWebAppPlatform")??"ios";return["android","ios"].includes(t)?s:["tdesktop","macos"].includes(t)?r:o},a="not_supported",n=(e,t)=>{const o=new URLSearchParams(window.location.hash.slice(1)).get("tgWebAppVersion");return Number(o?.replace(".",""))>=Number(String(e)?.replace(".",""))&&-1!==t.indexOf(p())},i=()=>Math.random().toString(36).substring(3,9),u=e=>{var t;if(t=/^\s*#([0-9a-f]{6})\s*$/i.exec(e+=""))return"#"+t[1].toLowerCase();if(t=/^\s*#([0-9a-f])([0-9a-f])([0-9a-f])\s*$/i.exec(e))return("#"+t[1]+t[1]+t[2]+t[2]+t[3]+t[3]).toLowerCase();if(t=/^\s*rgba?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*(\d+\.{0,1}\d*))?\)\s*$/.exec(e)){var o=parseInt(t[1]),s=parseInt(t[2]),r=parseInt(t[3]);return"#"+((o<16?"0":"")+o.toString(16))+((s<16?"0":"")+s.toString(16))+((r<16?"0":"")+r.toString(16))}return!1},d=e=>{const t=window.location.hash.slice(1),o=new URLSearchParams(t),s=JSON.parse(o.get("tgWebAppThemeParams")??""),r=e||s;for(var p of Object.keys(r)){var a=u(r[p]);"string"==typeof a&&(r[p]=a)}return"#1c1c1d"==r?.bg_color&&r?.bg_color==r?.secondary_bg_color&&(r.secondary_bg_color="#2c2c2e"),r.bottom_bar_bg_color,r},c=e=>_()?(ge(me,e),{status:!0}):(le(me,1),{status:a}),_=()=>n(0,[o,r,s]),l=e=>x()?(ge(ve,e),{status:!0}):(le(ve,1),{status:a}),x=()=>n(6.4,[s]),g=e=>h()?(ge(fe,e),{status:!0}):(le(fe,1),{status:a}),h=()=>n(0,[o,r,s]),b=e=>w()?(ge(Ce,e),{status:!0}):(le(Ce,1),{status:a}),w=()=>n(0,[s]),S=e=>m()?(ge(Re,e),{status:!0}):(le(Re,1),{status:a}),m=()=>n(0,[o]),v=()=>f()?(ge(Re),{status:!0}):(le(Re,1),{status:a}),f=()=>n(0,[o]),C=async e=>R()?(void 0===e.req_id&&(e.req_id=i()),ge(he,e),new Promise(((t,o)=>{const s=o=>{o.req_id===e.req_id&&(t({status:!0,data:o}),tt(Ue,s))};et(Ue,s)}))):(le(he,1),{status:a}),R=()=>n(6.9,[o,r,s]),P=e=>B()?(ge(Be,e),{status:!0}):(le(Be,1),{status:a}),B=()=>n(6.1,[o,r,s]),y=e=>k()?(ge(ye,e),{status:!0}):(le(ye,1),{status:a}),k=()=>n(6.4,[o,r,s]),M=async e=>q()?(e.title.length>64&&le(ke,3),e.message.length<1&&le(ke,4),e.message.length>256&&le(ke,5),e.buttons.length<1&&le(ke,6),e.buttons.length>3&&le(ke,7),void 0!==e.buttons.find((e=>e.text?.match(/^(ok|close|cancel)$/g)))&&le(ke,8),ge(ke,e),new Promise(((t,o)=>{const s=o=>{t({status:!!e.buttons.find((e=>e.id===o?.button_id)),data:o}),tt(je,s)};et(je,s)}))):(le(ke,1),{status:a}),q=()=>n(6.2,[o,r,s]),O=async e=>T()?(ge(be,e),new Promise(((t,o)=>{ot(ze,(o=>{e.is_close&&l(),t({status:!0,data:o})})),ot(Ke,(()=>{t({status:"closed"})}))}))):(le(be,1),{status:a}),T=()=>n(6.4,[s]),I=e=>("/"!==e.path_full[0]&&(e.path_full="/"+e.path_full),E()?(ge(Me,e),{status:!0}):(le(Me,1),{status:a})),E=()=>n(7,[o,r,s]),W=async e=>L()?(e||(e={req_id:void 0}),void 0===e.req_id&&(e.req_id=i()),ge(we,e),new Promise(((t,o)=>{const s=o=>{o.req_id===e?.req_id&&(t({status:!0,data:o}),tt(Je,s))};et(Je,s)}))):(le(we,1),{status:a}),L=()=>n(6.4,[o,r,s]),Q=e=>D()?(ge(qe,e),{status:!0}):(le(qe,1),{status:a}),D=()=>n(6.9,[o,r,s]),A=async()=>N()?(ge(Se),new Promise(((e,t)=>{ot($e,(t=>{"sent"===t.status&&e({status:!0}),e({status:!1})}))}))):(le(Se,1),{status:a}),N=()=>n(6.9,[o,r,s]),H=e=>F()?(ge(Oe,e),{status:!0}):(le(Oe,1),{status:a}),F=()=>n(0,[o,r,s]),V=e=>G()?(ge(Te,e),{status:!0}):(le(Te,1),{status:a}),G=()=>n(0,[o,r,s]),J=()=>U()?(ge(Ie),{status:!0}):(le(Ie,1),{status:a}),U=()=>n(6.9,[o,r,s]),$=e=>j()?(ge(Ee,e),{status:!0}):(le(Ee,1),{status:a}),j=()=>n(6.1,[o,r,s]),z=e=>K()?(ge(We,e),{status:!0}):(le(We,1),{status:a}),K=()=>n(6.1,[o,r,s]),X=e=>Y()?(ge(Le,{color:e?.color||e?.color_key}),{status:!0}):(le(Le,1),{status:a}),Y=()=>n(710,[o,r,s]),Z=e=>ee()?(ge(Qe,e),{status:!0}):(le(Qe,1),{status:a}),ee=()=>n(6.1,[o,r,s]),te=e=>oe()?(ge(De,e),{status:!0}):(le(De,1),{status:a}),oe=()=>n(0,[o,r,s]),se=e=>re()?(ge(Ae,e),{status:!0}):(le(Ae,1),{status:a}),re=()=>n(0,[o,r,s]),pe=e=>ae()?(ge(Ne,e),{status:!0}):(le(Ne,1),{status:a}),ae=()=>n(6.1,[o,r,s]),ne=e=>ie()?(e.query.length>256&&le(He,9),ge(He,e),{status:!0}):(le(He,1),{status:a}),ie=()=>n(6.7,[o,r,s]),ue=e=>de()?(ge(Fe,e),{status:!0}):(le(Fe,1),{status:a}),de=()=>n(6.1,[s]),ce=e=>_e()?(ge(Ve,e),{status:!0}):(le(Ve,1),{status:a}),_e=()=>n(7.7,[o,r,s]);var le=(e,t)=>{"development"===process.env.NODE_ENV&&console.error(`[@apiteam/twa-bridge](${e}) = ${t}`)};const xe=()=>{const e=window.location.hash.slice(1),t=new URLSearchParams(e).get("tgWebAppData");if(!t)return void le("getInitData",2);const o=new URLSearchParams(t);let s={};return o.forEach(((e,t)=>{if(s[t]=e,void 0!==t.match(/^(chat|receiver|user)$/g))try{s[t]=JSON.parse(e)}catch{}})),s};var ge=(e,t)=>{if(window.TelegramWebviewProxy)window.TelegramWebviewProxy.postEvent(e,JSON.stringify(t));else if(window.external&&"notify"in window.external)window.external.notify(JSON.stringify({eventType:e,eventData:t}));else try{"*",window.parent.postMessage(JSON.stringify({eventType:e,eventData:t}),"*")}catch(e){le("postMessage Iframe",10)}};const he="web_app_invoke_custom_method",be="web_app_open_scan_qr_popup",we="web_app_read_text_from_clipboard",Se="web_app_request_phone",me="web_app_close",ve="web_app_close_scan_qr_popup",fe="web_app_data_send",Ce="web_app_expand",Re="iframe_ready",Pe="iframe_will_reload",Be="web_app_open_invoice",ye="web_app_open_link",ke="web_app_open_popup",Me="web_app_open_tg_link",qe="web_app_ready",Oe="web_app_request_theme",Te="web_app_request_viewport",Ie="web_app_request_write_access",Ee="web_app_set_background_color",We="web_app_set_header_color",Le="web_app_set_bottom_bar_color",Qe="web_app_setup_back_button",De="web_app_setup_closing_behavior",Ae="web_app_setup_main_button",Ne="web_app_setup_settings_button",He="web_app_switch_inline_query",Fe="web_app_trigger_haptic_feedback",Ve="web_app_setup_swipe_behavior";var Ge=(e=>(e[e.InvokeCustomMethod=he]="InvokeCustomMethod",e[e.OpenScanQrPopup=be]="OpenScanQrPopup",e[e.ReadTextFromClipboard=we]="ReadTextFromClipboard",e[e.RequestPhone=Se]="RequestPhone",e[e.Close=me]="Close",e[e.CloseScanQrPopup=ve]="CloseScanQrPopup",e[e.DataSend=fe]="DataSend",e[e.Expand=Ce]="Expand",e[e.IframeReady=Re]="IframeReady",e[e.IframeWillReload=Pe]="IframeWillReload",e[e.OpenInvoice=Be]="OpenInvoice",e[e.OpenLink=ye]="OpenLink",e[e.OpenPopup=ke]="OpenPopup",e[e.OpenTgLink=Me]="OpenTgLink",e[e.Ready=qe]="Ready",e[e.RequestTheme=Oe]="RequestTheme",e[e.RequestViewport=Te]="RequestViewport",e[e.RequestWriteAccess=Ie]="RequestWriteAccess",e[e.SetBackgroundColor=Ee]="SetBackgroundColor",e[e.SetHeaderColor=We]="SetHeaderColor",e[e.SetBottomBarColor=Le]="SetBottomBarColor",e[e.SetupBackButton=Qe]="SetupBackButton",e[e.SetupClosingBehavior=De]="SetupClosingBehavior",e[e.SetupMainButton=Ae]="SetupMainButton",e[e.SetupSettingsButton=Ne]="SetupSettingsButton",e[e.SwitchInlineQuery=He]="SwitchInlineQuery",e[e.TriggerHapticFeedback=Fe]="TriggerHapticFeedback",e[e.SetupSwipeBehavior=Ve]="SetupSwipeBehavior",e))(Ge||{});const Je="clipboard_text_received",Ue="custom_method_invoked",$e="phone_requested",je="popup_closed",ze="qr_text_received",Ke="scan_qr_popup_closed",Xe="theme_changed",Ye="viewport_changed",Ze=((e=new Map)=>({once:(t,o,s=e.get(t),r=(e=>{o(e),s&&s.splice(s.indexOf(o)>>>0,1)}))=>s?s.push(r):e.set(t,[r]),on:(t,o,s=e.get(t))=>s?s.push(o):e.set(t,[o]),off:(t,o,s=e.get(t))=>s&&o?s.splice(s.indexOf(o)>>>0,1):e.set(t,[]),emit:(t,o,s=e.get(t)||[])=>{for(const e of s)e(o)}}))();(()=>{function e(e,t){e===Xe&&(t.theme_params=d(t.theme_params)),Ze.emit(e,t),Ze.emit("*",{name:e,data:t})}window.TelegramGameProxy_receiveEvent=e,window.Telegram={WebView:{receiveEvent:e}},window.TelegramGameProxy={receiveEvent:e}})();const et=(e,t)=>{Ze.on(e,t)},tt=(e,t)=>{Ze.off(e,t)},ot=(e,t)=>{Ze.once(e,t)};var st=Object.freeze({__proto__:null,off:tt,on:et,once:ot});const rt=e.createContext({viewport:void 0,theme:void 0,init:void 0});exports.ContextTwa=rt,exports.EventBackButtonPressed="back_button_pressed",exports.EventClipboardTextReceived=Je,exports.EventCustomMethodInvoked=Ue,exports.EventInvoiceClosed="invoice_closed",exports.EventMainButtonPressed="main_button_pressed",exports.EventPhoneRequested=$e,exports.EventPopupClosed=je,exports.EventQrTextReceived=ze,exports.EventReloadIframe="reload_iframe",exports.EventScanQrPopupClosed=Ke,exports.EventSetCustomStyle="set_custom_style",exports.EventSettingsButtonPressed="settings_button_pressed",exports.EventThemeChanged=Xe,exports.EventViewportChanged=Ye,exports.EventWriteAccessRequested="write_access_requested",exports.Method=Ge,exports.MethodClose=me,exports.MethodCloseScanQrPopup=ve,exports.MethodDataSend=fe,exports.MethodExpand=Ce,exports.MethodIframeReady=Re,exports.MethodIframeWillReload=Pe,exports.MethodInvokeCustomMethod=he,exports.MethodOpenInvoice=Be,exports.MethodOpenLink=ye,exports.MethodOpenPopup=ke,exports.MethodOpenScanQrPopup=be,exports.MethodOpenTgLink=Me,exports.MethodReadTextFromClipboard=we,exports.MethodReady=qe,exports.MethodRequestPhone=Se,exports.MethodRequestTheme=Oe,exports.MethodRequestViewport=Te,exports.MethodRequestWriteAccess=Ie,exports.MethodSetBackgroundColor=Ee,exports.MethodSetBottomBarColor=Le,exports.MethodSetHeaderColor=We,exports.MethodSetupBackButton=Qe,exports.MethodSetupClosingBehavior=De,exports.MethodSetupMainButton=Ae,exports.MethodSetupSettingsButton=Ne,exports.MethodSetupSwipeBehavior=Ve,exports.MethodSwitchInlineQuery=He,exports.MethodTriggerHapticFeedback=Fe,exports.NOT_SUPPORTED=a,exports.ProviderTWA=o=>{const[s,r]=t.createStore({viewport:void 0,theme:void 0,init:void 0});return e.createEffect((()=>{const t=()=>{r("init",xe())};t();const o=e=>{t(),r("viewport",{...e,safe_area_bottom:e.is_expanded&&e.is_state_stable?window.outerHeight-e.height:0})};et(Ye,o),V();const s=e=>{t(),r("theme",e)};return et(Xe,s),V(),e.onCleanup((()=>{tt(Ye,o),tt(Xe,s)})),()=>{tt(Ye,o),tt(Xe,s)}})),rt.Provider({value:s,children:o.children})},exports.TG_DESKTOP=r,exports.TG_PHONE=s,exports.TG_WEB=o,exports.bridgeClose=c,exports.bridgeCloseScanQrPopup=l,exports.bridgeDataSend=g,exports.bridgeExpand=b,exports.bridgeGetInitData=xe,exports.bridgeGetThemeParams=d,exports.bridgeIframeReady=S,exports.bridgeIframeWillReload=v,exports.bridgeInvokeCustomMethod=C,exports.bridgeOpenInvoice=P,exports.bridgeOpenLink=y,exports.bridgeOpenPopup=M,exports.bridgeOpenScanQrPopup=O,exports.bridgeOpenTgLink=I,exports.bridgeReadTextFromClipboard=W,exports.bridgeReady=Q,exports.bridgeRequestPhone=A,exports.bridgeRequestTheme=H,exports.bridgeRequestViewport=V,exports.bridgeRequestWriteAccess=J,exports.bridgeSend=ge,exports.bridgeSessionStorageGet=({key:e})=>{try{return{is_json:!0,value:JSON.parse(window.sessionStorage.getItem("__telegram__"+e)??""),status:!0}}catch(t){return{is_json:!1,value:window.sessionStorage.getItem("__telegram__"+e)??"",status:!0}}},exports.bridgeSessionStorageSet=({key:e,value:t})=>{try{return window.sessionStorage.setItem("__telegram__"+e,JSON.stringify(t)),{status:!0}}catch(o){return window.sessionStorage.setItem("__telegram__"+e,t),{status:!0}}},exports.bridgeSetBackgroundColor=$,exports.bridgeSetBottomBarColor=X,exports.bridgeSetHeaderColor=z,exports.bridgeSetupBackButton=Z,exports.bridgeSetupClosingBehavior=te,exports.bridgeSetupMainButton=se,exports.bridgeSetupSettingsButton=pe,exports.bridgeSetupSwipeBehavior=ce,exports.bridgeSwitchInlineQuery=ne,exports.bridgeTriggerHapticFeedback=ue,exports.createIsViewportChanged=()=>{const[t,o]=e.createSignal({height:0,is_expanded:!1,is_state_stable:!1}),s=e=>o(e);return e.onMount((()=>{et(Ye,s),ge(Te)})),e.onCleanup((()=>{tt(Ye,s)})),t},exports.debug=le,exports.getAppData=()=>{const e=window.location.hash.slice(1);return new URLSearchParams(e).get("tgWebAppData")},exports.getPlatform=p,exports.listener=st,exports.sender=ge,exports.supportClose=_,exports.supportCloseScanQrPopup=x,exports.supportDataSend=h,exports.supportExpand=w,exports.supportIframeReady=m,exports.supportIframeWillReload=f,exports.supportInvokeCustomMethod=R,exports.supportOpenInvoice=B,exports.supportOpenLink=k,exports.supportOpenPopup=q,exports.supportOpenScanQrPopup=T,exports.supportOpenTgLink=E,exports.supportReadTextFromClipboard=L,exports.supportReady=D,exports.supportRequestPhone=N,exports.supportRequestTheme=F,exports.supportRequestViewport=G,exports.supportRequestWriteAccess=U,exports.supportSessionStorageGet=()=>!0,exports.supportSessionStorageSet=()=>!0,exports.supportSetBackgroundColor=j,exports.supportSetBottomBarColor=Y,exports.supportSetHeaderColor=K,exports.supportSetupBackButton=ee,exports.supportSetupClosingBehavior=oe,exports.supportSetupMainButton=re,exports.supportSetupSettingsButton=ae,exports.supportSetupSwipeBehavior=_e,exports.supportSwitchInlineQuery=ie,exports.supportTriggerHapticFeedback=de;
