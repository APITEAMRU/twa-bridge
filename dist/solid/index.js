"use strict";var e=require("solid-js");const t="web",s="phone",o="desktop",r="not_supported",p=(e,r)=>{const p=new URLSearchParams(window.location.hash.slice(1)).get("tgWebAppVersion");return Number(p)>=e&&-1!==r.indexOf((()=>{const e=window.location.hash.slice(1),r=new URLSearchParams(e).get("tgWebAppPlatform")??"ios";return["android","ios"].includes(r)?s:["tdesktop","macos"].includes(r)?o:t})())},a=()=>Math.random().toString(36).substring(3,9),n=()=>p(0,[t,o,s]),u=()=>i()?(Q($),{status:!0}):(W($,1),{status:r}),i=()=>p(6.4,[s]),d=()=>p(0,[t,o,s]),_=()=>p(0,[s]),c=()=>p(0,[t]),x=()=>p(0,[t]),l="web_app_invoke_custom_method",g=()=>p(6.9,[t,o,s]),b=()=>p(6.1,[t,o,s]),h=()=>p(6.4,[t,o,s]),w=()=>p(6.2,[t,o,s]),m=()=>p(6.4,[s]),v=()=>p(7,[t,o,s]),S=()=>p(6.4,[t,o,s]),f=()=>p(6.9,[t,o,s]),M=()=>p(6.9,[t,o,s]),P=()=>p(0,[t,o,s]),q=()=>p(0,[t,o,s]),R=()=>p(6.9,[t,o,s]),k=()=>p(6.1,[t,o,s]),C=()=>p(6.1,[t,o,s]),y=()=>p(6.1,[t,o,s]),E=()=>p(0,[t,o,s]),O=()=>p(0,[t,o,s]),T=()=>p(6.1,[t,o,s]),B=()=>p(6.7,[t,o,s]),I=()=>p(6.1,[s]);var W=(e,t)=>{"development"===process.env.NODE_ENV&&console.error(`[@apiteam/twa-bridge](${e}) = ${t}`)};var Q=(e,t)=>{window.TelegramWebviewProxy?window.TelegramWebviewProxy.postEvent(e,JSON.stringify(t)):window.external&&"notify"in window.external&&window.external.notify(JSON.stringify({eventType:e,eventData:t}))};const D=((e=new Map)=>({once:(t,s,o=e.get(t),r=(e=>{s(e),o&&o.splice(o.indexOf(s)>>>0,1)}))=>o?o.push(r):e.set(t,[r]),on:(t,s,o=e.get(t))=>o?o.push(s):e.set(t,[s]),off:(t,s,o=e.get(t))=>o&&s?o.splice(o.indexOf(s)>>>0,1):e.set(t,[]),emit:(t,s,o=e.get(t)||[])=>{for(const e of o)e(s)}}))();(()=>{function e(e,t){D.emit(e,t),D.emit("*",{name:e,data:t})}window.TelegramGameProxy_receiveEvent=e,window.Telegram={WebView:{receiveEvent:e}},window.TelegramGameProxy={receiveEvent:e}})();const L=(e,t)=>{D.on(e,t)},N=(e,t)=>{D.off(e,t)},V=(e,t)=>{D.once(e,t)};var A=Object.freeze({__proto__:null,off:N,on:L,once:V});const H="web_app_open_scan_qr_popup",F="web_app_read_text_from_clipboard",G="web_app_request_phone",U="web_app_close",$="web_app_close_scan_qr_popup",J="web_app_data_send",j="web_app_expand",z="iframe_ready",K="web_app_open_invoice",X="web_app_open_link",Y="web_app_open_popup",Z="web_app_open_tg_link",ee="web_app_ready",te="web_app_request_theme",se="web_app_request_viewport",oe="web_app_request_write_access",re="web_app_set_background_color",pe="web_app_set_header_color",ae="web_app_setup_back_button",ne="web_app_setup_closing_behavior",ue="web_app_setup_main_button",ie="web_app_setup_settings_button",de="web_app_switch_inline_query",_e="web_app_trigger_haptic_feedback",ce="clipboard_text_received",xe="custom_method_invoked",le="phone_requested",ge="popup_closed",be="qr_text_received",he="scan_qr_popup_closed",we="viewport_changed";exports.EventBackButtonPressed="back_button_pressed",exports.EventClipboardTextReceived=ce,exports.EventCustomMethodInvoked=xe,exports.EventInvoiceClosed="invoice_closed",exports.EventMainButtonPressed="main_button_pressed",exports.EventPhoneRequested=le,exports.EventPopupClosed=ge,exports.EventQrTextReceived=be,exports.EventReloadIframe="reload_iframe",exports.EventScanQrPopupClosed=he,exports.EventSetCustomStyle="set_custom_style",exports.EventSettingsButtonPressed="settings_button_pressed",exports.EventThemeChanged="theme_changed",exports.EventViewportChanged=we,exports.EventWriteAccessRequested="write_access_requested",exports.MethodClose=U,exports.MethodCloseScanQrPopup=$,exports.MethodDataSend=J,exports.MethodExpand=j,exports.MethodIframeReady=z,exports.MethodIframeWillReload="iframe_will_reload",exports.MethodInvokeCustomMethod="web_app_invoke_custom_method",exports.MethodOpenInvoice=K,exports.MethodOpenLink=X,exports.MethodOpenPopup=Y,exports.MethodOpenScanQrPopup=H,exports.MethodOpenTgLink=Z,exports.MethodReadTextFromClipboard=F,exports.MethodReady=ee,exports.MethodRequestPhone=G,exports.MethodRequestTheme=te,exports.MethodRequestViewport=se,exports.MethodRequestWriteAccess=oe,exports.MethodSetBackgroundColor=re,exports.MethodSetHeaderColor=pe,exports.MethodSetupBackButton=ae,exports.MethodSetupClosingBehavior=ne,exports.MethodSetupMainButton=ue,exports.MethodSetupSettingsButton=ie,exports.MethodSwitchInlineQuery=de,exports.MethodTriggerHapticFeedback=_e,exports.NOT_SUPPORTED=r,exports.TG_DESKTOP=o,exports.TG_PHONE=s,exports.TG_WEB=t,exports.bridgeClose=()=>n()?(Q(U),{status:!0}):(W(U,1),{status:r}),exports.bridgeCloseScanQrPopup=u,exports.bridgeDataSend=e=>d()?(Q(J,e),{status:!0}):(W(J,1),{status:r}),exports.bridgeExpand=()=>_()?(Q(j),{status:!0}):(W(j,1),{status:r}),exports.bridgeGetInitData=()=>{const e=new URLSearchParams(window.location.hash.slice(1)).get("tgWebAppData");if(null===e)return W("getInitData",2),null;const t=new URLSearchParams(e);let s={};return t.forEach(((e,t)=>{if(s[t]=e,void 0!==t.match(/^(chat|receiver|user)$/g))try{s[t]=JSON.parse(e)}catch{}})),s},exports.bridgeIframeReady=e=>c()?(Q(z,e),{status:!0}):(W(z,1),{status:r}),exports.bridgeIframeWillReload=()=>x()?(Q(z),{status:!0}):(W(z,1),{status:r}),exports.bridgeInvokeCustomMethod=async e=>g()?(void 0===e.req_id&&(e.req_id=a()),Q(l,e),new Promise(((t,s)=>{const o=s=>{s.req_id===e.req_id&&(t({status:!0,data:s}),N(xe,o))};L(xe,o)}))):(W(l,1),{status:r}),exports.bridgeOpenInvoice=e=>b()?(Q(K,e),{status:!0}):(W(K,1),{status:r}),exports.bridgeOpenLink=e=>h()?(Q(X,e),{status:!0}):(W(X,1),{status:r}),exports.bridgeOpenPopup=async e=>w()?(e.title.length>64&&W(Y,3),e.message.length<1&&W(Y,4),e.message.length>256&&W(Y,5),e.buttons.length<1&&W(Y,6),e.buttons.length>3&&W(Y,7),void 0!==e.buttons.find((e=>e.text?.match(/^(ok|close|cancel)$/g)))&&W(Y,8),Q(Y,e),new Promise(((t,s)=>{const o=s=>{t({status:!!e.buttons.find((e=>e.id===s?.button_id)),data:s}),N(ge,o)};L(ge,o)}))):(W(Y,1),{status:r}),exports.bridgeOpenScanQrPopup=async e=>m()?(Q(H,e),new Promise(((t,s)=>{V(be,(s=>{e.is_close&&u(),t({status:!0,data:s})})),V(he,(()=>{t({status:"closed"})}))}))):(W(H,1),{status:r}),exports.bridgeOpenTgLink=e=>("/"!==e.path_full[0]&&(e.path_full="/"+e.path_full),v()?(Q(Z,e),{status:!0}):(W(Z,1),{status:r})),exports.bridgeReadTextFromClipboard=async e=>S()?(void 0===e.req_id&&(e.req_id=a()),Q(F,e),new Promise(((t,s)=>{const o=s=>{s.req_id===e.req_id&&(t({status:!0,data:s}),N(ce,o))};L(ce,o)}))):(W(F,1),{status:r}),exports.bridgeReady=()=>f()?(Q(ee),{status:!0}):(W(ee,1),{status:r}),exports.bridgeRequestPhone=async()=>M()?(Q(G),new Promise(((e,t)=>{V(le,(t=>{"sent"===t.status&&e({status:!0}),e({status:!1})}))}))):(W(G,1),{status:r}),exports.bridgeRequestTheme=()=>P()?(Q(te),{status:!0}):(W(te,1),{status:r}),exports.bridgeRequestViewport=()=>q()?(Q(se),{status:!0}):(W(se,1),{status:r}),exports.bridgeRequestWriteAccess=()=>R()?(Q(oe),{status:!0}):(W(oe,1),{status:r}),exports.bridgeSetBackgroundColor=e=>k()?(Q(re,e),{status:!0}):(W(re,1),{status:r}),exports.bridgeSetHeaderColor=e=>C()?(Q(pe,e),{status:!0}):(W(pe,1),{status:r}),exports.bridgeSetupBackButton=e=>y()?(Q(ae,e),{status:!0}):(W(ae,1),{status:r}),exports.bridgeSetupClosingBehavior=e=>E()?(Q(ne,e),{status:!0}):(W(ne,1),{status:r}),exports.bridgeSetupMainButton=e=>O()?(Q(ue,e),{status:!0}):(W(ue,1),{status:r}),exports.bridgeSetupSettingsButton=e=>T()?(Q(ie,e),{status:!0}):(W(ie,1),{status:r}),exports.bridgeSwitchInlineQuery=e=>B()?(e.query.length>256&&W(de,9),Q(de,e),{status:!0}):(W(de,1),{status:r}),exports.bridgeTriggerHapticFeedback=e=>I()?(Q(_e,e),{status:!0}):(W(_e,1),{status:r}),exports.createIsViewportChanged=()=>{const[t,s]=e.createSignal({height:0,is_expanded:!1,is_state_stable:!1}),o=e=>s(e);return e.onMount((()=>{L(we,o),Q(se)})),e.onCleanup((()=>{N(we,o)})),t},exports.debug=W,exports.listener=A,exports.sender=Q,exports.supportClose=n,exports.supportCloseScanQrPopup=i,exports.supportDataSend=d,exports.supportExpand=_,exports.supportIframeReady=c,exports.supportIframeWillReload=x,exports.supportInvokeCustomMethod=g,exports.supportOpenInvoice=b,exports.supportOpenLink=h,exports.supportOpenPopup=w,exports.supportOpenScanQrPopup=m,exports.supportOpenTgLink=v,exports.supportReadTextFromClipboard=S,exports.supportReady=f,exports.supportRequestPhone=M,exports.supportRequestTheme=P,exports.supportRequestViewport=q,exports.supportRequestWriteAccess=R,exports.supportSetBackgroundColor=k,exports.supportSetHeaderColor=C,exports.supportSetupBackButton=y,exports.supportSetupClosingBehavior=E,exports.supportSetupMainButton=O,exports.supportSetupSettingsButton=T,exports.supportSwitchInlineQuery=B,exports.supportTriggerHapticFeedback=I;
