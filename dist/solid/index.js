"use strict";var e=require("solid"),t=require("utils"),s=require("solid-js");const o="web",r="phone",p="desktop",a="not_supported",n=(e,t)=>{const s=new URLSearchParams(window.location.hash.slice(1)).get("tgWebAppVersion");return Number(s)>=e&&-1!==t.indexOf((()=>{const e=window.location.hash.slice(1),t=new URLSearchParams(e).get("tgWebAppPlatform")??"ios";return["android","ios"].includes(t)?r:["tdesktop","macos"].includes(t)?p:o})())},i=()=>Math.random().toString(36).substring(3,9),u=()=>n(0,[o,p,r]),d=()=>_()?(L(j),{status:!0}):(D(j,1),{status:a}),_=()=>n(6.4,[r]),c=()=>n(0,[o,p,r]),x=()=>n(0,[r]),l=()=>n(0,[o]),h=()=>n(0,[o]),g="web_app_invoke_custom_method",b=()=>n(6.9,[o,p,r]),w=()=>n(6.1,[o,p,r]),m=()=>n(6.4,[o,p,r]),v=()=>n(6.2,[o,p,r]),S=()=>n(6.4,[r]),f=()=>n(7,[o,p,r]),q=()=>n(6.4,[o,p,r]),M=()=>n(6.9,[o,p,r]),P=()=>n(6.9,[o,p,r]),R=()=>n(0,[o,p,r]),k=()=>n(0,[o,p,r]),C=()=>n(6.9,[o,p,r]),y=()=>n(6.1,[o,p,r]),E=()=>n(6.1,[o,p,r]),T=()=>n(6.1,[o,p,r]),O=()=>n(0,[o,p,r]),B=()=>n(0,[o,p,r]),I=()=>n(6.1,[o,p,r]),W=()=>n(6.7,[o,p,r]),Q=()=>n(6.1,[r]);var D=(e,t)=>{"development"===process.env.NODE_ENV&&console.error(`[@apiteam/twa-bridge](${e}) = ${t}`)};var L=(e,t)=>{window.TelegramWebviewProxy?window.TelegramWebviewProxy.postEvent(e,JSON.stringify(t)):window.external&&"notify"in window.external&&window.external.notify(JSON.stringify({eventType:e,eventData:t}))};const N=((e=new Map)=>({once:(t,s,o=e.get(t),r=(e=>{s(e),o&&o.splice(o.indexOf(s)>>>0,1)}))=>o?o.push(r):e.set(t,[r]),on:(t,s,o=e.get(t))=>o?o.push(s):e.set(t,[s]),off:(t,s,o=e.get(t))=>o&&s?o.splice(o.indexOf(s)>>>0,1):e.set(t,[]),emit:(t,s,o=e.get(t)||[])=>{for(const e of o)e(s)}}))();(()=>{function s(s,o){s===e.EventThemeChanged&&(o.theme_params=t.getThemeParams(o.theme_params)),N.emit(s,o),N.emit("*",{name:s,data:o})}window.TelegramGameProxy_receiveEvent=s,window.Telegram={WebView:{receiveEvent:s}},window.TelegramGameProxy={receiveEvent:s}})();const V=(e,t)=>{N.on(e,t)},A=(e,t)=>{N.off(e,t)},H=(e,t)=>{N.once(e,t)};var F=Object.freeze({__proto__:null,off:A,on:V,once:H});const G="web_app_open_scan_qr_popup",U="web_app_read_text_from_clipboard",$="web_app_request_phone",J="web_app_close",j="web_app_close_scan_qr_popup",z="web_app_data_send",K="web_app_expand",X="iframe_ready",Y="web_app_open_invoice",Z="web_app_open_link",ee="web_app_open_popup",te="web_app_open_tg_link",se="web_app_ready",oe="web_app_request_theme",re="web_app_request_viewport",pe="web_app_request_write_access",ae="web_app_set_background_color",ne="web_app_set_header_color",ie="web_app_setup_back_button",ue="web_app_setup_closing_behavior",de="web_app_setup_main_button",_e="web_app_setup_settings_button",ce="web_app_switch_inline_query",xe="web_app_trigger_haptic_feedback",le="clipboard_text_received",he="custom_method_invoked",ge="phone_requested",be="popup_closed",we="qr_text_received",me="scan_qr_popup_closed",ve="viewport_changed";exports.EventBackButtonPressed="back_button_pressed",exports.EventClipboardTextReceived=le,exports.EventCustomMethodInvoked=he,exports.EventInvoiceClosed="invoice_closed",exports.EventMainButtonPressed="main_button_pressed",exports.EventPhoneRequested=ge,exports.EventPopupClosed=be,exports.EventQrTextReceived=we,exports.EventReloadIframe="reload_iframe",exports.EventScanQrPopupClosed=me,exports.EventSetCustomStyle="set_custom_style",exports.EventSettingsButtonPressed="settings_button_pressed",exports.EventThemeChanged="theme_changed",exports.EventViewportChanged=ve,exports.EventWriteAccessRequested="write_access_requested",exports.MethodClose=J,exports.MethodCloseScanQrPopup=j,exports.MethodDataSend=z,exports.MethodExpand=K,exports.MethodIframeReady=X,exports.MethodIframeWillReload="iframe_will_reload",exports.MethodInvokeCustomMethod="web_app_invoke_custom_method",exports.MethodOpenInvoice=Y,exports.MethodOpenLink=Z,exports.MethodOpenPopup=ee,exports.MethodOpenScanQrPopup=G,exports.MethodOpenTgLink=te,exports.MethodReadTextFromClipboard=U,exports.MethodReady=se,exports.MethodRequestPhone=$,exports.MethodRequestTheme=oe,exports.MethodRequestViewport=re,exports.MethodRequestWriteAccess=pe,exports.MethodSetBackgroundColor=ae,exports.MethodSetHeaderColor=ne,exports.MethodSetupBackButton=ie,exports.MethodSetupClosingBehavior=ue,exports.MethodSetupMainButton=de,exports.MethodSetupSettingsButton=_e,exports.MethodSwitchInlineQuery=ce,exports.MethodTriggerHapticFeedback=xe,exports.NOT_SUPPORTED=a,exports.TG_DESKTOP=p,exports.TG_PHONE=r,exports.TG_WEB=o,exports.bridgeClose=()=>u()?(L(J),{status:!0}):(D(J,1),{status:a}),exports.bridgeCloseScanQrPopup=d,exports.bridgeDataSend=e=>c()?(L(z,e),{status:!0}):(D(z,1),{status:a}),exports.bridgeExpand=()=>x()?(L(K),{status:!0}):(D(K,1),{status:a}),exports.bridgeGetInitData=()=>{const e=new URLSearchParams(window.location.hash.slice(1)).get("tgWebAppData");if(null===e)return D("getInitData",2),null;const t=new URLSearchParams(e);let s={};return t.forEach(((e,t)=>{if(s[t]=e,void 0!==t.match(/^(chat|receiver|user)$/g))try{s[t]=JSON.parse(e)}catch{}})),s},exports.bridgeIframeReady=e=>l()?(L(X,e),{status:!0}):(D(X,1),{status:a}),exports.bridgeIframeWillReload=()=>h()?(L(X),{status:!0}):(D(X,1),{status:a}),exports.bridgeInvokeCustomMethod=async e=>b()?(void 0===e.req_id&&(e.req_id=i()),L(g,e),new Promise(((t,s)=>{const o=s=>{s.req_id===e.req_id&&(t({status:!0,data:s}),A(he,o))};V(he,o)}))):(D(g,1),{status:a}),exports.bridgeOpenInvoice=e=>w()?(L(Y,e),{status:!0}):(D(Y,1),{status:a}),exports.bridgeOpenLink=e=>m()?(L(Z,e),{status:!0}):(D(Z,1),{status:a}),exports.bridgeOpenPopup=async e=>v()?(e.title.length>64&&D(ee,3),e.message.length<1&&D(ee,4),e.message.length>256&&D(ee,5),e.buttons.length<1&&D(ee,6),e.buttons.length>3&&D(ee,7),void 0!==e.buttons.find((e=>e.text?.match(/^(ok|close|cancel)$/g)))&&D(ee,8),L(ee,e),new Promise(((t,s)=>{const o=s=>{t({status:!!e.buttons.find((e=>e.id===s?.button_id)),data:s}),A(be,o)};V(be,o)}))):(D(ee,1),{status:a}),exports.bridgeOpenScanQrPopup=async e=>S()?(L(G,e),new Promise(((t,s)=>{H(we,(s=>{e.is_close&&d(),t({status:!0,data:s})})),H(me,(()=>{t({status:"closed"})}))}))):(D(G,1),{status:a}),exports.bridgeOpenTgLink=e=>("/"!==e.path_full[0]&&(e.path_full="/"+e.path_full),f()?(L(te,e),{status:!0}):(D(te,1),{status:a})),exports.bridgeReadTextFromClipboard=async e=>q()?(void 0===e.req_id&&(e.req_id=i()),L(U,e),new Promise(((t,s)=>{const o=s=>{s.req_id===e.req_id&&(t({status:!0,data:s}),A(le,o))};V(le,o)}))):(D(U,1),{status:a}),exports.bridgeReady=()=>M()?(L(se),{status:!0}):(D(se,1),{status:a}),exports.bridgeRequestPhone=async()=>P()?(L($),new Promise(((e,t)=>{H(ge,(t=>{"sent"===t.status&&e({status:!0}),e({status:!1})}))}))):(D($,1),{status:a}),exports.bridgeRequestTheme=()=>R()?(L(oe),{status:!0}):(D(oe,1),{status:a}),exports.bridgeRequestViewport=()=>k()?(L(re),{status:!0}):(D(re,1),{status:a}),exports.bridgeRequestWriteAccess=()=>C()?(L(pe),{status:!0}):(D(pe,1),{status:a}),exports.bridgeSetBackgroundColor=e=>y()?(L(ae,e),{status:!0}):(D(ae,1),{status:a}),exports.bridgeSetHeaderColor=e=>E()?(L(ne,e),{status:!0}):(D(ne,1),{status:a}),exports.bridgeSetupBackButton=e=>T()?(L(ie,e),{status:!0}):(D(ie,1),{status:a}),exports.bridgeSetupClosingBehavior=e=>O()?(L(ue,e),{status:!0}):(D(ue,1),{status:a}),exports.bridgeSetupMainButton=e=>B()?(L(de,e),{status:!0}):(D(de,1),{status:a}),exports.bridgeSetupSettingsButton=e=>I()?(L(_e,e),{status:!0}):(D(_e,1),{status:a}),exports.bridgeSwitchInlineQuery=e=>W()?(e.query.length>256&&D(ce,9),L(ce,e),{status:!0}):(D(ce,1),{status:a}),exports.bridgeTriggerHapticFeedback=e=>Q()?(L(xe,e),{status:!0}):(D(xe,1),{status:a}),exports.createIsViewportChanged=()=>{const[e,t]=s.createSignal({height:0,is_expanded:!1,is_state_stable:!1}),o=e=>t(e);return s.onMount((()=>{V(ve,o),L(re)})),s.onCleanup((()=>{A(ve,o)})),e},exports.debug=D,exports.listener=F,exports.sender=L,exports.supportClose=u,exports.supportCloseScanQrPopup=_,exports.supportDataSend=c,exports.supportExpand=x,exports.supportIframeReady=l,exports.supportIframeWillReload=h,exports.supportInvokeCustomMethod=b,exports.supportOpenInvoice=w,exports.supportOpenLink=m,exports.supportOpenPopup=v,exports.supportOpenScanQrPopup=S,exports.supportOpenTgLink=f,exports.supportReadTextFromClipboard=q,exports.supportReady=M,exports.supportRequestPhone=P,exports.supportRequestTheme=R,exports.supportRequestViewport=k,exports.supportRequestWriteAccess=C,exports.supportSetBackgroundColor=y,exports.supportSetHeaderColor=E,exports.supportSetupBackButton=T,exports.supportSetupClosingBehavior=O,exports.supportSetupMainButton=B,exports.supportSetupSettingsButton=I,exports.supportSwitchInlineQuery=W,exports.supportTriggerHapticFeedback=Q;
